!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Ad){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(Ad),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i,o="FirebaseError",a=(n(u,i=Error),u);function u(t,e,n){e=i.call(this,e)||this;return e.code=t,e.customData=n,e.name=o,Object.setPrototypeOf(e,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,c.prototype.create),e}var c=(l.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(p,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new a(o,t,i)},l);function l(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var f,p=/\{\$([^}]+)}/g;function v(t){return t&&t._delegate?t._delegate:t}(Ee=f=f||{})[Ee.DEBUG=0]="DEBUG",Ee[Ee.VERBOSE=1]="VERBOSE",Ee[Ee.INFO=2]="INFO",Ee[Ee.WARN=3]="WARN",Ee[Ee.ERROR=4]="ERROR",Ee[Ee.SILENT=5]="SILENT";function d(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=b[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var m={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},w=f.INFO,b=((Te={})[f.DEBUG]="log",Te[f.VERBOSE]="log",Te[f.INFO]="info",Te[f.WARN]="warn",Te[f.ERROR]="error",Te),_=(Object.defineProperty(E.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in f))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),E.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?m[t]:t},Object.defineProperty(E.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),E.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],t)),this._logHandler.apply(this,s([this,f.DEBUG],t))},E.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],t)),this._logHandler.apply(this,s([this,f.VERBOSE],t))},E.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],t)),this._logHandler.apply(this,s([this,f.INFO],t))},E.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],t)),this._logHandler.apply(this,s([this,f.WARN],t))},E.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],t)),this._logHandler.apply(this,s([this,f.ERROR],t))},E);function E(t){this.name=t,this._logLevel=w,this._logHandler=d,this._userLogHandler=null}var T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N={},D=A||self;function R(){}function C(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),L=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function M(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function x(t,e,n){return(x=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:M).apply(null,arguments)}function F(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function V(){return Date.now()}function U(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,O)&&t[O]||(t[O]=++L))},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var Q,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function z(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=D.navigator;if(X){X=X.userAgent;if(X){Q=X;break t}}Q=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e,n={};for(e in t)n[e]=t[e];return n}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Z.length;i++)e=Z[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function et(t){return et[" "](t),t}et[" "]=R;var nt,rt=z(Q,"Opera"),it=z(Q,"Trident")||z(Q,"MSIE"),ot=z(Q,"Edge"),st=ot||it,at=z(Q,"Gecko")&&!(z(Q.toLowerCase(),"webkit")&&!z(Q,"Edge"))&&!(z(Q,"Trident")||z(Q,"MSIE"))&&!z(Q,"Edge"),ut=z(Q.toLowerCase(),"webkit")&&!z(Q,"Edge");function ct(){var t=D.document;return t?t.documentMode:void 0}t:{var ht="",lt=(lt=Q,at?/rv:([^\);]+)(\)|;)/.exec(lt):ot?/Edge\/([\d\.]+)/.exec(lt):it?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lt):ut?/WebKit\/(\S+)/.exec(lt):rt?/(?:Version)[ \/]?(\S+)/.exec(lt):void 0);if(lt&&(ht=lt?lt[1]:""),it){lt=ct();if(null!=lt&&lt>parseFloat(ht)){nt=String(lt);break t}}nt=ht}var ft={};function pt(a){return t=a,e=function(){for(var t=0,e=W(String(nt)).split("."),n=W(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=ft,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var dt=D.document&&it&&(ct()||parseInt(nt,10))||void 0,yt=!it||9<=Number(dt),gt=it&&!pt("9"),vt=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{D.addEventListener("test",R,e),D.removeEventListener("test",R,e)}catch(t){}return t}();function mt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(mt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}mt.prototype.b=function(){this.defaultPrevented=!0},U(wt,mt);var bt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var _t="closure_listenable_"+(1e6*Math.random()|0),Et=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Et,this.Y=this.Z=!1}function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function St(t){this.src=t,this.a={},this.b=0}function At(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(It(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Nt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}St.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Nt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Tt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Dt="closure_lm_"+(1e6*Math.random()|0),Rt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Vt(r);return e&&e[_t]?e.wa(n,r,k(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Vt(n),t&&t[_t]?t.va(e,n,k(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!yt)return null;var a,u,c=xt(t);if(c||(t[Dt]=c=new St(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=Mt,r=u=yt?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)void 0===(i=!vt?s:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[_t]?At(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=xt(e))?(At(n,t),0==n.b&&(n.src=null,e[Dt]=null)):It(t)))}function Lt(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Pt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function Mt(t,e){if(t.Y)return!0;if(yt)return Pt(t,new wt(e,this));if(!e)t:{e=["window","event"];for(var n=D,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Pt(t,e=new wt(e,this))}function xt(t){return(t=t[Dt])instanceof St?t:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(e){return"function"==typeof e?e:(e[Ft]||(e[Ft]=function(t){return e.handleEvent(t)}),e[Ft])}function Ut(){q.call(this),this.c=new St(this),(this.J=this).C=null}function qt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new mt(e,t):e instanceof mt?e.target=e.target||t:(s=e,tt(e=new mt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Bt(o,r,!0,e)&&s;if(s=Bt(o=e.a=t,r,!0,e)&&s,s=Bt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Bt(o=e.a=n[i],r,!1,e)&&s}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.ca||u.src,u.Z&&At(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}U(Ut,q),Ut.prototype[_t]=!0,(S=Ut.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=Vt(r),e&&e[_t]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Nt(s=e.a[n],r,i,o))&&(It(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&xt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?Nt(n,r,i,o):e)?n[e]:null)&&Ot(r))}(this,t,e,n,r)},S.G=function(){if(Ut.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)It(n[r]);delete e.a[t],e.b--}}this.C=null},S.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var jt=D.JSON.stringify;function Gt(){this.b=this.a=null}var Kt,Ht=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt(function(){return new Wt},function(t){t.reset()}));function Qt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Wt(){this.next=this.b=this.a=null}function zt(t,e){var n;Kt||(n=D.Promise.resolve(void 0),Kt=function(){n.then(Jt)}),Yt||(Kt(),Yt=!0),Xt.add(t,e)}Gt.prototype.add=function(t,e){var n=Ht.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Wt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Yt=!(Wt.prototype.reset=function(){this.next=this.b=this.a=null}),Xt=new Gt;function Jt(){for(var t,e;n=e=void 0,n=null,(e=Xt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){D.setTimeout(function(){throw t},0)}(t)}var n=Ht;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Yt=!1}function $t(t,e){Ut.call(this),this.b=t||1,this.a=e||D,this.f=x(this.Za,this),this.g=V()}function Zt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function te(t,e,n){if("function"==typeof t)n&&(t=x(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=x(t.handleEvent,t)}return 2147483647<Number(e)?-1:D.setTimeout(t,e||0)}U($t,Ut),(S=$t.prototype).aa=!1,S.M=null,S.Za=function(){var t;this.aa&&(0<(t=V()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),qt(this,"tick"),this.aa&&(Zt(this),this.start())))},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=V())},S.G=function(){$t.X.G.call(this),Zt(this),delete this.a};var ee,ne,re,ie=(T(ne=se,re=ee=q),ne.prototype=null===re?Object.create(re):(oe.prototype=re.prototype,new oe),se.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=te(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},se.prototype.G=function(){ee.prototype.G.call(this),this.a&&(D.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},se);function oe(){this.constructor=ne}function se(t,e){var n=ee.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ae(t){q.call(this),this.b=t,this.a={}}U(ae,q);var ue=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ot(t)},t),t.a={}}function le(){this.a=!0}function fe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return jt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ae.prototype.G=function(){ae.X.G.call(this),he(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.info=function(){};var pe={},de=null;function ye(){return de=de||new Ut}function ge(t){mt.call(this,pe.Fa,t)}function ve(t){var e=ye();qt(e,new ge(e))}function me(t,e){mt.call(this,pe.STAT_EVENT,t),this.stat=e}function we(t){var e=ye();qt(e,new me(e,t))}function be(t){mt.call(this,pe.Ga,t)}function _e(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){t()},e)}pe.Fa="serverreachability",U(ge,mt),pe.STAT_EVENT="statevent",U(me,mt),pe.Ga="timingevent",U(be,mt);var Ee={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Te={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ie(){}function Se(t){var e;return e=!(e=t.a)?t.a={}:e}function Ae(){}Ie.prototype.a=null;A={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ne(){mt.call(this,"d")}function De(){mt.call(this,"c")}function Re(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ae(this),this.P=Oe,t=st?125:void 0,this.R=new $t(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}U(Ne,mt),U(De,mt),U(Re,Ie);var ke=new Re,Oe=45e3,Le={},Pe={};function Me(t,e,n){t.H=1,t.i=nn(Xe(e)),t.j=n,t.I=!0,xe(t,null)}function xe(t,e){t.u=V(),Ve(t),t.l=Xe(t.i);var s,a,u,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),gn(n.b,"t",r),t.D=0,t.a=cr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(x(t.Ca,t,t.a),t.O)),ce(t.J,t.a,"readystatechange",t.Xa),e=t.B?$(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ve(1),s=t.c,a=t.m,u=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function Fe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=i=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Pe:(i=Number(a.substring(i,o)),isNaN(i)?Le:(o+=1)+i>a.length?Pe:(a=a.substr(o,i),r.D=o+i,a)));if(a==Pe){4==e&&(t.h=4,we(14),s=!1),fe(t.c,t.f,null,"[Incomplete Response]");break}if(a==Le){t.h=4,we(15),fe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}fe(t.c,t.f,a,null),Ge(t,a)}4==e&&0==n.length&&(t.h=1,we(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),er(e),e.F=!0,we(11))):(fe(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),Be(t))}function Ve(t){t.T=V()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=_e(x(t.Va,t),e)}function qe(t){t.o&&(D.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||ir(t.g,t)}function je(t){qe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Zt(t.R),he(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ge(t,e){try{var n,r,i,o,s,a=t.g;if(0!=a.v&&(a.a==t||Tn(a.b,t)))if(a.I=t.N,!t.C&&Tn(a.b,t)&&3==a.v){try{var u=a.ka.a.parse(e)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){t:if(!a.j){if(a.a){if(!(a.a.u+3e3<t.u))break t;rr(a),Qn(a)}tr(a),we(18)}}else a.oa=c[1],0<a.oa-a.P&&c[2]<37500&&a.H&&0==a.o&&!a.m&&(a.m=_e(x(a.Sa,a),6e3));if(En(a.b)<=1&&a.ea){try{a.ea()}catch(t){}a.ea=void 0}}else sr(a,11)}else if(!t.C&&a.a!=t||rr(a),!H(e))for(e=u=a.ka.a.parse(e),u=0;u<e.length;u++)c=e[u],a.P=c[0],c=c[1],2==a.v?"c"==c[0]?(a.J=c[1],a.ga=c[2],null!=(r=c[3])&&(a.ha=r,a.c.info("VER="+a.ha)),null!=(o=c[4])&&(a.pa=o,a.c.info("SVER="+a.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,a.D=n,a.c.info("backChannelRequestTimeoutMs_="+n)),n=a,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(z(r,"spdy")||z(r,"quic")||z(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(In(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,en(n.B,n.A,s))),a.v=3,a.f&&a.f.ta(),a.U&&(a.N=V()-t.u,a.c.info("Handshake RTT: "+a.N+"ms")),i=t,(n=a).la=ur(n,n.C?n.ga:null,n.fa),i.C?(Sn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(qe(o),Ve(o)),n.a=i):Zn(n),0<a.g.length&&Yn(a)):"stop"!=c[0]&&"close"!=c[0]||sr(a,7):3==a.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?sr(a,7):Hn(a):"noop"!=c[0]&&a.f&&a.f.sa(c),a.o=0);ve(4)}catch(t){}}function Ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||"string"==typeof t)j(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(C(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function He(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Ce.prototype).setTimeout=function(t){this.P=t},S.Xa=function(t){t=t.target;var e=this.F;e&&3==Bn(t)?e.f():this.Ca(t)},S.Ca=function(t){try{if(t==this.a)t:{var e=Bn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ve(8==n||r<=0?3:2),qe(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,r=this.c,u=this.m,c=this.l,h=this.f,l=this.S,f=e,p=i,r.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+l+"]: "+u+"\n"+c+"\n"+f+" "+p}),this.b){if(this.U&&!this.C){e:{if(this.a){var s=this.a;if((s=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,we(12),je(this),Be(this);break t}fe(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ge(this,a)}this.I?(Fe(this,e,o),st&&this.b&&3==e&&(ce(this.J,this.R,"tick",this.Wa),this.R.start())):(fe(this.c,this.f,o,null),Ge(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?ir(this.g,this):(this.b=!1,Ve(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,we(12)):(this.h=0,we(13)),je(this),Be(this)}}}catch(t){}var u,c,h,l,f,p},S.Wa=function(){var t,e;this.a&&(t=Bn(this.a),e=this.a.$(),this.D<e.length&&(qe(this),Fe(this,t,e),this.b&&4!=t&&Ve(this)))},S.cancel=function(){this.A=!0,je(this)},S.Va=function(){this.o=null;var t,e,n=V();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ve(3),we(17)),je(this),this.h=2,Be(this)):Ue(this,this.T-n)},(S=He.prototype).K=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.L=function(){return Qe(this),this.a.concat()},S.get=function(t,e){return We(this.b,t)?this.b[t]:e},S.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,$e(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b,(n=new fn).c=e.c,e.a&&(n.a=new He(e.a),n.b=e.b),tn(this,n),this.i=t.i):t&&(n=String(t).match(ze))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=rn(n[2]||""),$e(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Xe(t){return new Ye(t)}function Je(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof fn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(pn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),gn(this,n,t))},r)),r.f=i):(n||(e=on(e,hn)),t.b=new fn(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(n){n.a||(n.a=new He,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){pn(t),e=vn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t)))}function yn(t,e){return pn(t),e=vn(t,e),We(t.a.b,e)}function gn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(vn(t,e),K(n)),t.b+=n.length)}function vn(t,e){return e=String(e),e=t.f?e.toLowerCase():e}(S=fn.prototype).add=function(t,e){pn(this),this.c=null,t=vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(n,r){pn(this),this.a.forEach(function(t,e){j(t,function(t){n.call(r,t,e,this)},this)},this)},S.L=function(){pn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.K=function(t){pn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=G(e,this.a.get(vn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},S.set=function(t,e){return pn(this),this.c=null,yn(this,t=vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=function(t,e){this.b=t,this.a=e};function wn(t){this.g=t||bn,t=D.PerformanceNavigationTiming?0<(t=D.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(D.ia&&D.ia.ya&&D.ia.ya()&&D.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function _n(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function In(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function An(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Nn(){}function Dn(){this.a=new Nn}function Rn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wn.prototype.cancel=function(){var e,t;if(this.c=An(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Nn.prototype.stringify=function(t){return D.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return D.JSON.parse(t,void 0)};var Cn=D.JSON.parse;function kn(t){Ut.call(this),this.headers=new He,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}U(kn,Ut);var On="",Ln=/^https?$/i,Pn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function xn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Fn(t),Un(t)}function Fn(t){t.u||(t.u=!0,qt(t,"complete"),qt(t,"error"))}function Vn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Bn(t)||2!=t.W()))if(t.l&&4==Bn(t))te(t.za,0,t);else if(qt(t,"readystatechange"),4==Bn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.B).match(ze)[1]||null)&&D.self&&D.self.location&&(i=(r=D.self.location.protocol).substr(0,r.length-1)),n=!Ln.test(i?i.toLowerCase():"")),e=n);if(e)qt(t,"complete"),qt(t,"success");else{t.h=6;try{var a=2<Bn(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",Fn(t)}}finally{Un(t)}}}function Un(t,e){if(t.a){qn(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||qt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function qn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(D.clearTimeout(t.m),t.m=null)}function Bn(t){return t.a?t.a.readyState:0}function jn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Kn(t){this.pa=0,this.g=[],this.c=new le,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Gn("baseRetryDelayMs",5e3,t),this.Ra=Gn("retryDelaySeedMs",1e4,t),this.Ma=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(t&&t.concurrentRequestLimit),this.ka=new Dn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Hn(t){var e,n;Wn(t),3==t.v&&(e=t.R++,en(n=Xe(t.B),"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),Jn(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=nn(Xe(n)),n=!1,!(n=D.navigator&&D.navigator.sendBeacon?D.navigator.sendBeacon(e.i.toString(),""):n)&&D.Image&&((new Image).src=e.i,n=!0),n||(e.a=cr(e.g,null),e.a.ba(e.i)),e.u=V(),Ve(e)),ar(t)}function Qn(t){t.a&&(er(t),t.a.cancel(),t.a=null)}function Wn(t){Qn(t),t.j&&(D.clearTimeout(t.j),t.j=null),rr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&D.clearTimeout(t.h),t.h=null)}function zn(t,e){t.g.push(new mn(t.Oa++,e)),3==t.v&&Yn(t)}function Yn(t){_n(t.b)||t.h||(t.h=!0,zt(t.Ba,t),t.u=0)}function Xn(t,e){var n=e?e.f:t.R++,r=Xe(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),Jn(t,r),t.i&&t.l&&jn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),In(t.b,n),Me(n,r,e)}function Jn(t,n){t.f&&Ke({},function(t,e){en(n,e,t)})}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?x(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,r,e){var i=e||"";try{Ke(t,function(t,e){var n=t;k(t)&&(n=jt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Zn(t){t.a||t.j||(t.T=1,zt(t.Aa,t),t.o=0)}function tr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=_e(x(t.Aa,t),or(t,t.o)),t.o++,1)}function er(t){null!=t.s&&(D.clearTimeout(t.s),t.s=null)}function nr(t){t.a=new Ce(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),Jn(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&jn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Xe(e)),n.j=null,n.I=!0,xe(n,t)}function rr(t){null!=t.m&&(D.clearTimeout(t.m),t.m=null)}function ir(t,e){var n,r,i,o=null;if(t.a==e){rr(t),er(t),t.a=null;var s=2}else{if(!Tn(t.b,e))return;o=e.s,Sn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=V()-e.u,n=t.u,qt(s=ye(),new be(s)),Yn(t)):Zn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,En((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=_e(x(r.Ba,r,i),or(r,r.u)),r.u++,0))))&&(2!=s||!tr(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:sr(t,5);break;case 4:sr(t,10);break;case 3:sr(t,6);break;default:sr(t,2)}}function or(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function sr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=x(t.Ya,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||Je(r,"https"),nn(r)),n=r.toString(),r=o,o=new le,D.Image?((i=new Image).onload=F(Rn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=F(Rn,o,i,"TestLoadImage: error",!1,r),i.onabort=F(Rn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=F(Rn,o,i,"TestLoadImage: timeout",!1,r),D.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):we(2),t.v=0,t.f&&t.f.ra(e),ar(t),Wn(t)}function ar(t){t.v=0,t.I=-1,t.f&&(0==An(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function ur(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Ye?Xe(s):new Ye(s,void 0);return""!=u.c?(e&&$e(u,e+"."+u.c),Ze(u,u.h)):(a=D.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Ye(null,void 0),r&&Je(a,r),i&&$e(a,i),o&&Ze(a,o),s&&(a.g=s),u=a),t.V&&J(t.V,function(t,e){en(u,e,t)}),e=t.A,n=t.na,e&&n&&en(u,e,n),en(u,"VER",t.ha),Jn(t,u),u}function cr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.Na)).F=t.C,e}function hr(){}function lr(){if(it&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function fr(t,e){Ut.call(this),this.a=new Kn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new yr(this)}function pr(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function dr(){De.call(this),this.status=1}function yr(t){this.a=t}(S=kn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Se(this.H):Se(ke),this.a.onreadystatechange=x(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void xn(this,t)}t=n||"";var i,o=new He(this.headers);r&&Ke(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=D.FormData&&t instanceof D.FormData,0<=B(Pn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{qn(this),0<this.o&&((this.D=(i=this.a,it&&pt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=x(this.xa,this)):this.m=te(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){xn(this,t)}},S.xa=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,qt(this,"timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,qt(this,"complete"),qt(this,"abort"),Un(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0)),kn.X.G.call(this)},S.za=function(){this.j||(this.A||this.l||this.g?Vn(this):this.Ua())},S.Ua=function(){Vn(this)},S.W=function(){try{return 2<Bn(this)?this.a.status:-1}catch(t){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},S.ua=function(){return this.h},S.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=Kn.prototype).ha=8,S.v=1,S.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?tt(r=$(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),en(i=Xe(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&jn(i,this.i,r),In(this.b,n),this.Ia&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Me(n,i,null)):Me(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||_n(this.b)||Xn(this))},S.Aa=function(){var t;this.j=null,nr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=_e(x(this.Ta,this),t))},S.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,we(10),Qn(this),nr(this))},S.Sa=function(){null!=this.m&&(this.m=null,Qn(this),tr(this),we(19))},S.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),we(2)):(this.c.info("Failed to ping google.com"),we(1))},(S=hr.prototype).ta=function(){},S.sa=function(){},S.ra=function(){},S.qa=function(){},S.Ja=function(){},lr.prototype.a=function(t,e){return new fr(t,e)},U(fr,Ut),fr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;we(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ur(t,null,t.fa),Yn(t)},fr.prototype.close=function(){Hn(this.a)},fr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,zn(this.a,e)):this.l?((e={}).__data__=jt(t),zn(this.a,e)):zn(this.a,t)},fr.prototype.G=function(){this.a.f=null,delete this.f,Hn(this.a),delete this.a,fr.X.G.call(this)},U(pr,Ne),U(dr,De),U(yr,hr),yr.prototype.ta=function(){qt(this.a,"a")},yr.prototype.sa=function(t){qt(this.a,new pr(t))},yr.prototype.ra=function(t){qt(this.a,new dr)},yr.prototype.qa=function(){qt(this.a,"b")},lr.prototype.createWebChannel=lr.prototype.a,fr.prototype.send=fr.prototype.h,fr.prototype.open=fr.prototype.g,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(Ae.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",Ut.prototype.listen=Ut.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Qa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Pa,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var gr=ye,vr=Ee,mr=Te,wr=pe,br=10,_r=11,Er=Ae,Tr=kn,Ir=(Sr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Sr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Sr);function Sr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Ir.o=-1;var Ar,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=(n(Cr,Ar=Error),Cr),Rr=new _("@firebase/firestore");function Cr(t,e){var n=this;return(n=Ar.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function kr(){return Rr.logLevel}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Rr.logLevel<=f.DEBUG&&(e=n.map(Mr),Rr.debug.apply(Rr,s(["Firestore (8.3.2): "+t],e)))}function Lr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Rr.logLevel<=f.ERROR&&(e=n.map(Mr),Rr.error.apply(Rr,s(["Firestore (8.3.2): "+t],e)))}function Pr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Rr.logLevel<=f.WARN&&(e=n.map(Mr),Rr.warn.apply(Rr,s(["Firestore (8.3.2): "+t],e)))}function Mr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function xr(t){t="FIRESTORE (8.3.2) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Lr(t),new Error(t)}function Fr(t){t||xr()}var Vr=(Ur.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ur);function Ur(){}function qr(t,e){return t<e?-1:e<t?1:0}function Br(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}var jr=(Hr.now=function(){return Hr.fromMillis(Date.now())},Hr.fromDate=function(t){return Hr.fromMillis(t.getTime())},Hr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Hr(e,1e6*(t-1e3*e))},Hr.prototype.toDate=function(){return new Date(this.toMillis())},Hr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Hr.prototype._compareTo=function(t){return this.seconds===t.seconds?qr(this.nanoseconds,t.nanoseconds):qr(this.seconds,t.seconds)},Hr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Hr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Hr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Hr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Hr),Gr=(Kr.fromTimestamp=function(t){return new Kr(t)},Kr.min=function(){return new Kr(new jr(0,0))},Kr.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Kr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Kr.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Kr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Kr.prototype.toTimestamp=function(){return this.timestamp},Kr);function Kr(t){this.timestamp=t}function Hr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Dr(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Dr(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Dr(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Qr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Wr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Yr,Xr,Te=(Object.defineProperty(si.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),si.prototype.isEqual=function(t){return 0===si.comparator(this,t)},si.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof si?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},si.prototype.limit=function(){return this.offset+this.length},si.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},si.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},si.prototype.firstSegment=function(){return this.segments[this.offset]},si.prototype.lastSegment=function(){return this.get(this.length-1)},si.prototype.get=function(t){return this.segments[this.offset+t]},si.prototype.isEmpty=function(){return 0===this.length},si.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},si.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},si.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},si.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},si.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},si),Jr=(n(oi,Xr=Te),oi.prototype.construct=function(t,e,n){return new oi(t,e,n)},oi.prototype.canonicalString=function(){return this.toArray().join("/")},oi.prototype.toString=function(){return this.canonicalString()},oi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new oi(n)},oi.emptyPath=function(){return new oi([])},oi),$r=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Zr=(n(ii,Yr=Te),ii.prototype.construct=function(t,e,n){return new ii(t,e,n)},ii.isValidIdentifier=function(t){return $r.test(t)},ii.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!ii.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},ii.prototype.toString=function(){return this.canonicalString()},ii.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},ii.keyField=function(){return new ii(["__name__"])},ii.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Dr(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Dr(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Dr(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ii(e)},ii.emptyPath=function(){return new ii([])},ii),ti=(ri.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},ri.prototype.isEqual=function(t){return Br(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ri),ei=(ni.fromBase64String=function(t){return new ni(atob(t))},ni.fromUint8Array=function(t){return new ni(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ni.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},ni.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},ni.prototype.approximateByteSize=function(){return 2*this.binaryString.length},ni.prototype.compareTo=function(t){return qr(this.binaryString,t.binaryString)},ni.prototype.isEqual=function(t){return this.binaryString===t.binaryString},ni);function ni(t){this.binaryString=t}function ri(t){(this.fields=t).sort(Zr.comparator)}function ii(){return null!==Yr&&Yr.apply(this,arguments)||this}function oi(){return null!==Xr&&Xr.apply(this,arguments)||this}function si(t,e,n){void 0===e?e=0:e>t.length&&xr(),void 0===n?n=t.length-e:n>t.length-e&&xr(),this.segments=t,this.offset=e,this.len=n}ei.EMPTY_BYTE_STRING=new ei("");var ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ui(t){if(Fr(!!t),"string"!=typeof t)return{seconds:ci(t.seconds),nanos:ci(t.nanos)};var e=0,n=ai.exec(t);Fr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function ci(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function hi(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function li(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fi(t){t=ui(t.mapValue.fields.__local_write_time__.timestampValue);return new jr(t.seconds,t.nanos)}function pi(t){return null==t}function di(t){return 0===t&&1/t==-1/0}var yi=(gi.fromPath=function(t){return new gi(Jr.fromString(t))},gi.fromName=function(t){return new gi(Jr.fromString(t).popFirst(5))},gi.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},gi.prototype.isEqual=function(t){return null!==t&&0===Jr.comparator(this.path,t.path)},gi.prototype.toString=function(){return this.path.toString()},gi.comparator=function(t,e){return Jr.comparator(t.path,e.path)},gi.isDocumentKey=function(t){return t.length%2==0},gi.fromSegments=function(t){return new gi(new Jr(t.slice()))},gi);function gi(t){this.path=t}function vi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?li(t)?4:10:xr()}function mi(r,i){var t,e,n=vi(r);if(n!==vi(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return fi(r).isEqual(fi(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=ui(r.timestampValue),t=ui(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,hi(r.bytesValue).isEqual(hi(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,ci((e=r).geoPointValue.latitude)===ci(t.geoPointValue.latitude)&&ci(e.geoPointValue.longitude)===ci(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ci(t.integerValue)===ci(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=ci(t.doubleValue),e=ci(e.doubleValue);return t===e?di(t)===di(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Br(r.arrayValue.values||[],i.arrayValue.values||[],mi);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Qr(e)!==Qr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!mi(e[t],n[t])))return!1;return!0}();default:return xr()}}function wi(t,e){return void 0!==(t.values||[]).find(function(t){return mi(t,e)})}function bi(t,e){var n,r,i,o=vi(t),s=vi(e);if(o!==s)return qr(o,s);switch(o){case 0:return 0;case 1:return qr(t.booleanValue,e.booleanValue);case 2:return r=e,i=ci(t.integerValue||t.doubleValue),r=ci(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return _i(t.timestampValue,e.timestampValue);case 4:return _i(fi(t),fi(e));case 5:return qr(t.stringValue,e.stringValue);case 6:return function(t,e){t=hi(t),e=hi(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=qr(n[i],r[i]);if(0!==o)return o}return qr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=qr(ci(n.latitude),ci(i.latitude)))?r:qr(ci(n.longitude),ci(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=bi(n[i],r[i]);if(o)return o}return qr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=qr(r[s],o[s]);if(0!==a)return a;a=bi(n[r[s]],i[o[s]]);if(0!==a)return a}return qr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw xr()}}function _i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return qr(t,e);var n=ui(t),t=ui(e),e=qr(n.seconds,t.seconds);return 0!==e?e:qr(n.nanos,t.nanos)}function Ei(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=ui(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?hi(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,yi.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):xr();var e}(t)}function Ti(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ii(t){return t&&"integerValue"in t}function Si(t){return!!t&&"arrayValue"in t}function Ai(t){return t&&"nullValue"in t}function Ni(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Di(t){return t&&"mapValue"in t}var Ri=(Ci.empty=function(){return new Ci({mapValue:{}})},Ci.prototype.field=function(t){return Ci.extractNestedValue(this.buildProto(),t)},Ci.prototype.toProto=function(){return this.field(Zr.emptyPath())},Ci.prototype.set=function(t,e){this.setOverlay(t,e)},Ci.prototype.setAll=function(t){var n=this;t.forEach(function(t,e){t?n.set(e,t):n.delete(e)})},Ci.prototype.delete=function(t){this.setOverlay(t,null)},Ci.prototype.isEqual=function(t){return mi(this.buildProto(),t.buildProto())},Ci.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===vi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.lastSegment(),e)},Ci.prototype.applyOverlay=function(r,t){var i=this,o=!1,e=Ci.extractNestedValue(this.partialValue,r),s=Di(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.applyOverlay(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Ci.prototype.buildProto=function(){var t=this.applyOverlay(Zr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},Ci.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Di(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},Ci.prototype.clone=function(){return new Ci(this.buildProto())},Ci);function Ci(t){this.overlayMap=new Map,this.partialValue=t}var ki=(Li.newInvalidDocument=function(t){return new Li(t,0,Gr.min(),Ri.empty(),0)},Li.newFoundDocument=function(t,e,n){return new Li(t,1,e,n,0)},Li.newNoDocument=function(t,e){return new Li(t,2,e,Ri.empty(),0)},Li.newUnknownDocument=function(t,e){return new Li(t,3,e,Ri.empty(),2)},Li.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Li.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ri.empty(),this.documentState=0,this},Li.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ri.empty(),this.documentState=2,this},Li.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Li.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Li.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Li.prototype.isValidDocument=function(){return 0!==this.documentType},Li.prototype.isFoundDocument=function(){return 1===this.documentType},Li.prototype.isNoDocument=function(){return 2===this.documentType},Li.prototype.isUnknownDocument=function(){return 3===this.documentType},Li.prototype.isEqual=function(t){return t instanceof Li&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Li.prototype.clone=function(){return new Li(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Li.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Li),Oi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Li(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function Pi(t,e,n,r,i,o,s){return new Oi(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Mi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+Ei(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ho(e.startAt)),e.endAt&&(t+="|ub:",t+=ho(e.endAt)),e.h=t),e.h}function xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!mi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!po(t.startAt,e.startAt)&&po(t.endAt,e.endAt)}function Fi(t){return yi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Vi,Ui=(n(qi,Vi=function(){}),qi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Ki(t,e,n):"array-contains"===e?new eo(t,n):"in"===e?new no(t,n):"not-in"===e?new ro(t,n):"array-contains-any"===e?new io(t,n):new qi(t,e,n)},qi.l=function(t,e,n){return new("in"===e?Hi:Qi)(t,n)},qi.prototype.matches=function(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.m(bi(t,this.value)):null!==t&&vi(this.value)===vi(t)&&this.m(bi(t,this.value))},qi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return xr()}},qi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},qi);function qi(t,e,n){var r=this;return(r=Vi.call(this)||this).field=t,r.op=e,r.value=n,r}var Bi,ji,Gi,Ki=(n(Yi,Gi=Ui),Yi.prototype.matches=function(t){t=yi.comparator(t.key,this.key);return this.m(t)},Yi),Hi=(n(zi,ji=Ui),zi.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},zi),Qi=(n(Wi,Bi=Ui),Wi.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Wi);function Wi(t,e){var n=this;return(n=Bi.call(this,t,"not-in",e)||this).keys=Xi(0,e),n}function zi(t,e){var n=this;return(n=ji.call(this,t,"in",e)||this).keys=Xi(0,e),n}function Yi(t,e,n){var r=this;return(r=Gi.call(this,t,e,n)||this).key=yi.fromName(n.referenceValue),r}function Xi(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return yi.fromName(t.referenceValue)})}var Ji,$i,Zi,to,eo=(n(co,to=Ui),co.prototype.matches=function(t){t=t.data.field(this.field);return Si(t)&&wi(t.arrayValue,this.value)},co),no=(n(uo,Zi=Ui),uo.prototype.matches=function(t){t=t.data.field(this.field);return null!==t&&wi(this.value.arrayValue,t)},uo),ro=(n(ao,$i=Ui),ao.prototype.matches=function(t){if(wi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!wi(this.value.arrayValue,t)},ao),io=(n(so,Ji=Ui),so.prototype.matches=function(t){var e=this,t=t.data.field(this.field);return!(!Si(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return wi(e.value.arrayValue,t)})},so),oo=function(t,e){this.position=t,this.before=e};function so(t,e){return Ji.call(this,t,"array-contains-any",e)||this}function ao(t,e){return $i.call(this,t,"not-in",e)||this}function uo(t,e){return Zi.call(this,t,"in",e)||this}function co(t,e){return to.call(this,t,"array-contains",e)||this}function ho(t){return(t.before?"b":"a")+":"+t.position.map(Ei).join(",")}var lo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function fo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?yi.comparator(yi.fromName(s.referenceValue),n.key):bi(s,n.data.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function po(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!mi(t.position[n],e.position[n]))return!1;return!0}var yo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function go(t){return new yo(t)}function vo(t){return!pi(t.limit)&&"F"===t.limitType}function mo(t){return!pi(t.limit)&&"L"===t.limitType}function wo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function bo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function _o(t){return null!==t.collectionGroup}function Eo(t){var e=t;if(null===e.p){e.p=[];var n=bo(e),t=wo(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new lo(n)),e.p.push(new lo(Zr.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new lo(Zr.keyField(),n)))}}return e.p}function To(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Pi(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Eo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new lo(o.field,s))}var a=e.endAt?new oo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new oo(e.startAt.position,!e.startAt.before):null;e.T=Pi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Io(t,e,n){return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function So(t,e){return xi(To(t),To(e))&&t.limitType===e.limitType}function Ao(t){return Mi(To(t))+"|lt:"+t.limitType}function No(t){return"Query(target="+(e=To(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Ei(t.value)}).join(", ")+"]"),pi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+ho(e.startAt)),e.endAt&&(n+=", endAt: "+ho(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Do(i,t){return t.isFoundDocument()&&(e=i,n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):yi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||fo(t.startAt,Eo(t),n))&&(!t.endAt||!fo(t.endAt,Eo(t),n)));var e,n}function Ro(a){return function(t,e){for(var n=!1,r=0,i=Eo(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?yi.comparator(r.key,e.key):function(t,e){var n=r.data.field(t),t=e.data.field(t);return null!==n&&null!==t?bi(n,t):xr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return xr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function Co(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:di(e)?"-0":e}}function ko(t){return{integerValue:""+t}}function Oo(t,e){return"number"==typeof(n=e)&&Number.isInteger(n)&&!di(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?ko(e):Co(t,e);var n}_=function(){this._=void 0};function Lo(t,e){return t instanceof Qo?Ii(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Po,Mo,xo=(n(Uo,Mo=_),Uo),Fo=(n(Vo,Po=_),Vo);function Vo(t){var e=this;return(e=Po.call(this)||this).elements=t,e}function Uo(){return null!==Mo&&Mo.apply(this,arguments)||this}function qo(t,e){for(var n=Yo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return mi(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Bo,jo=(n(Go,Bo=_),Go);function Go(t){var e=this;return(e=Bo.call(this)||this).elements=t,e}function Ko(t,e){for(var n=Yo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!mi(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Ho,Qo=(n(Wo,Ho=_),Wo);function Wo(t,e){var n=this;return(n=Ho.call(this)||this).R=t,n.A=e,n}function zo(t){return ci(t.integerValue||t.doubleValue)}function Yo(t){return Si(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Xo(t,e){this.field=t,this.transform=e}function Jo(t,e){this.version=t,this.transformResults=e}var $o=(Zo.none=function(){return new Zo},Zo.exists=function(t){return new Zo(void 0,t)},Zo.updateTime=function(t){return new Zo(t)},Object.defineProperty(Zo.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Zo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Zo);function Zo(t,e){this.updateTime=t,this.exists=e}function ts(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}Te=function(){};function es(t,e,n){var r,i,o,s;t instanceof ss?(i=e,o=n,ts((r=t).precondition,i)&&(s=r.value.clone(),o=fs(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(rs(i),s).setHasLocalMutations())):t instanceof as?(o=e,i=n,ts((s=t).precondition,o)&&(n=fs(s.fieldTransforms,i,o),(i=o.data).setAll(hs(s)),i.setAll(n),o.convertToFoundDocument(rs(o),i).setHasLocalMutations())):(e=e,ts(t.precondition,e)&&e.convertToNoDocument(Gr.min()))}function ns(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Br(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Fo&&e instanceof Fo||t instanceof jo&&e instanceof jo?Br(t.elements,e.elements,mi):t instanceof Qo&&e instanceof Qo?mi(t.A,e.A):t instanceof xo&&e instanceof xo)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function rs(t){return t.isFoundDocument()?t.version:Gr.min()}var is,os,ss=(n(cs,os=Te),cs),as=(n(us,is=Te),us);function us(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=is.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function cs(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=os.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function hs(n){var r=new Map;return n.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function ls(t,e,n){var r=new Map;Fr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof Fo?qo(o,s):o instanceof jo?Ko(o,s):a))}return r}function fs(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof xo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Fo?qo(u,r):u instanceof jo?Ko(u,r):(u=Lo(c=u,r),r=zo(u)+zo(c.A),Ii(u)&&Ii(c.A)?ko(r):Co(c.R,r))))}return i}function ps(t){this.count=t}var ds,ys,gs,vs=(n(bs,gs=Te),bs),ms=(n(ws,ys=Te),ws);function ws(t,e){var n=this;return(n=ys.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function bs(t,e){var n=this;return(n=gs.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function _s(t){switch(t){case Nr.OK:return xr(),0;case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return xr(),0}}function Es(t){if(void 0===t)return Lr("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case ds.OK:return Nr.OK;case ds.CANCELLED:return Nr.CANCELLED;case ds.UNKNOWN:return Nr.UNKNOWN;case ds.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case ds.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case ds.INTERNAL:return Nr.INTERNAL;case ds.UNAVAILABLE:return Nr.UNAVAILABLE;case ds.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case ds.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case ds.NOT_FOUND:return Nr.NOT_FOUND;case ds.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case ds.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case ds.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case ds.ABORTED:return Nr.ABORTED;case ds.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case ds.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case ds.DATA_LOSS:return Nr.DATA_LOSS;default:return xr()}}(_=ds=ds||{})[_.OK=0]="OK",_[_.CANCELLED=1]="CANCELLED",_[_.UNKNOWN=2]="UNKNOWN",_[_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_[_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_[_.NOT_FOUND=5]="NOT_FOUND",_[_.ALREADY_EXISTS=6]="ALREADY_EXISTS",_[_.PERMISSION_DENIED=7]="PERMISSION_DENIED",_[_.UNAUTHENTICATED=16]="UNAUTHENTICATED",_[_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_[_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_[_.ABORTED=10]="ABORTED",_[_.OUT_OF_RANGE=11]="OUT_OF_RANGE",_[_.UNIMPLEMENTED=12]="UNIMPLEMENTED",_[_.INTERNAL=13]="INTERNAL",_[_.UNAVAILABLE=14]="UNAVAILABLE",_[_.DATA_LOSS=15]="DATA_LOSS";var Ts=(Ds.prototype.insert=function(t,e){return new Ds(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ss.BLACK,null,null))},Ds.prototype.remove=function(t){return new Ds(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ss.BLACK,null,null))},Ds.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ds.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ds.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Ds.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Ds.prototype.minKey=function(){return this.root.minKey()},Ds.prototype.maxKey=function(){return this.root.maxKey()},Ds.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Ds.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Ds.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ds.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Ds.prototype.getIterator=function(){return new Is(this.root,null,this.comparator,!1)},Ds.prototype.getIteratorFrom=function(t){return new Is(this.root,t,this.comparator,!1)},Ds.prototype.getReverseIterator=function(){return new Is(this.root,null,this.comparator,!0)},Ds.prototype.getReverseIteratorFrom=function(t){return new Is(this.root,t,this.comparator,!0)},Ds),Is=(Ns.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Ns.prototype.hasNext=function(){return 0<this.nodeStack.length},Ns.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Ns),Ss=(As.prototype.copy=function(t,e,n,r,i){return new As(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},As.prototype.isEmpty=function(){return!1},As.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},As.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},As.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},As.prototype.minKey=function(){return this.min().key},As.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},As.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},As.prototype.removeMin=function(){if(this.left.isEmpty())return As.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},As.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return As.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},As.prototype.isRed=function(){return this.color},As.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},As.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},As.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},As.prototype.rotateLeft=function(){var t=this.copy(null,null,As.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},As.prototype.rotateRight=function(){var t=this.copy(null,null,As.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},As.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},As.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},As.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw xr();if(this.right.isRed())throw xr();var t=this.left.check();if(t!==this.right.check())throw xr();return t+(this.isRed()?0:1)},As);function As(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:As.RED,this.left=null!=r?r:As.EMPTY,this.right=null!=i?i:As.EMPTY,this.size=this.left.size+1+this.right.size}function Ns(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Ds(t,e){this.comparator=t,this.root=e||Ss.EMPTY}function Rs(){this.size=0}Ss.EMPTY=null,Ss.RED=!0,Ss.BLACK=!1,Ss.EMPTY=(Object.defineProperty(Rs.prototype,"key",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Rs.prototype,"value",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Rs.prototype,"color",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Rs.prototype,"left",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Rs.prototype,"right",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Rs.prototype.copy=function(t,e,n,r,i){return this},Rs.prototype.insert=function(t,e,n){return new Ss(t,e)},Rs.prototype.remove=function(t,e){return this},Rs.prototype.isEmpty=function(){return!0},Rs.prototype.inorderTraversal=function(t){return!1},Rs.prototype.reverseTraversal=function(t){return!1},Rs.prototype.minKey=function(){return null},Rs.prototype.maxKey=function(){return null},Rs.prototype.isRed=function(){return!1},Rs.prototype.checkMaxDepth=function(){return!0},Rs.prototype.check=function(){return 0},new Rs);var Cs=(Ps.prototype.has=function(t){return null!==this.data.get(t)},Ps.prototype.first=function(){return this.data.minKey()},Ps.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Ps.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Ps.prototype.indexOf=function(t){return this.data.indexOf(t)},Ps.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Ps.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Ps.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Ps.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Ps.prototype.getIterator=function(){return new ks(this.data.getIterator())},Ps.prototype.getIteratorFrom=function(t){return new ks(this.data.getIteratorFrom(t))},Ps.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Ps.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Ps.prototype.isEmpty=function(){return this.data.isEmpty()},Ps.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Ps.prototype.isEqual=function(t){if(!(t instanceof Ps))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Ps.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Ps.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Ps.prototype.copy=function(t){var e=new Ps(this.comparator);return e.data=t,e},Ps),ks=(Ls.prototype.getNext=function(){return this.iter.getNext().key},Ls.prototype.hasNext=function(){return this.iter.hasNext()},Ls),Os=new Ts(yi.comparator);function Ls(t){this.iter=t}function Ps(t){this.comparator=t,this.data=new Ts(this.comparator)}var Ms=new Ts(yi.comparator);var xs=new Ts(yi.comparator);var Fs=new Cs(yi.comparator);function Vs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Fs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Us=new Cs(qr);var qs=(Xs.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Bs.createSynthesizedTargetChangeForCurrentChange(t,e)),new Xs(Gr.min(),n,Us,Os,Vs())},Xs),Bs=(Ys.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new Ys(ei.EMPTY_BYTE_STRING,e,Vs(),Vs(),Vs())},Ys),js=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Gs=function(t,e){this.targetId=t,this.V=e},Ks=function(t,e,n,r){void 0===n&&(n=ei.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Hs=(Object.defineProperty(zs.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),zs.prototype.$=function(t){0<t.approximateByteSize()&&(this.F=!0,this.C=t)},zs.prototype.M=function(){var n=Vs(),r=Vs(),i=Vs();return this.D.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:xr()}}),new Bs(this.C,this.N,n,r,i)},zs.prototype.L=function(){this.F=!1,this.D=$s()},zs.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},zs.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},zs.prototype.U=function(){this.S+=1},zs.prototype.K=function(){--this.S},zs.prototype.j=function(){this.F=!0,this.N=!0},zs),Qs=(Ws.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},Ws.prototype.et=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.nt(t);switch(n.state){case 0:r.st(t)&&e.$(n.resumeToken);break;case 1:e.K(),e.k||e.L(),e.$(n.resumeToken);break;case 2:e.K(),e.k||r.removeTarget(t);break;case 3:r.st(t)&&(e.j(),e.$(n.resumeToken));break;case 4:r.st(t)&&(r.it(t),e.$(n.resumeToken));break;default:xr()}})},Ws.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach(function(t,e){r.st(e)&&n(e)})},Ws.prototype.rt=function(t){var e=t.targetId,n=t.V.count,t=this.ot(e);t&&(Fi(t=t.target)?0===n?(t=new yi(t.path),this.tt(e,t,ki.newNoDocument(t,Gr.min()))):Fr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},Ws.prototype.ut=function(r){var i=this,o=new Map;this.G.forEach(function(t,e){var n=i.ot(e);n&&(t.current&&Fi(n.target)&&(n=new yi(n.target.path),null!==i.H.get(n)||i.at(e,n)||i.tt(e,n,ki.newNoDocument(n,r))),t.O&&(o.set(e,t.M()),t.L()))});var s=Vs();this.J.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.ot(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new qs(r,o,this.Y,this.H,s);return this.H=Os,this.J=Js(),this.Y=new Cs(qr),t},Ws.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},Ws.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},Ws.prototype.removeTarget=function(t){this.G.delete(t)},Ws.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},Ws.prototype.U=function(t){this.nt(t).U()},Ws.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Hs,this.G.set(t,e)),e},Ws.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Cs(qr),this.J=this.J.insert(t,e)),e},Ws.prototype.st=function(t){var e=null!==this.ot(t);return e||Or("WatchChangeAggregator","Detected inactive target",t),e},Ws.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},Ws.prototype.it=function(e){var n=this;this.G.set(e,new Hs),this.W.getRemoteKeysForTarget(e).forEach(function(t){n.tt(e,t,null)})},Ws.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},Ws);function Ws(t){this.W=t,this.G=new Map,this.H=Os,this.J=Js(),this.Y=new Cs(qr)}function zs(){this.S=0,this.D=$s(),this.C=ei.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}function Ys(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function Xs(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function Js(){return new Ts(yi.comparator)}function $s(){return new Ts(yi.comparator)}var Zs={asc:"ASCENDING",desc:"DESCENDING"},ta={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ea=function(t,e){this.databaseId=t,this.I=e};function na(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ra(t,e){return t.I?e.toBase64():e.toUint8Array()}function ia(t){return Fr(!!t),Gr.fromTimestamp((t=ui(t),new jr(t.seconds,t.nanos)))}function oa(t,e){return new Jr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function sa(t){t=Jr.fromString(t);return Fr(Ea(t)),t}function aa(t,e){return oa(t.databaseId,e.path)}function ua(t,e){e=sa(e);if(e.get(1)!==t.databaseId.projectId)throw new Dr(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Dr(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new yi(la(e))}function ca(t,e){return oa(t.databaseId,e)}function ha(t){return new Jr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function la(t){return Fr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function fa(t,e,n){return{name:aa(t,e),fields:n.toProto().mapValue.fields}}function pa(t,e){var n,r,i;if(e instanceof ss)n={update:fa(t,e.key,e.value)};else if(e instanceof vs)n={delete:aa(t,e.key)};else if(e instanceof as)n={update:fa(t,e.key,e.data),updateMask:(i=e.fieldMask,r=[],i.fields.forEach(function(t){return r.push(t.canonicalString())}),{fieldPaths:r})};else{if(!(e instanceof ms))return xr();n={verify:aa(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof xo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Fo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof jo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof Qo)return{fieldPath:t.field.canonicalString(),increment:e.A};throw xr()})),e.precondition.isNone||(n.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:(e=t,t=i.updateTime,na(e,t.toTimestamp()))}:void 0!==i.exists?{exists:i.exists}:xr()),n}function da(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ca(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ca(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Ni(t.value))return{unaryFilter:{field:ma(t.field),op:"IS_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ma(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ni(t.value))return{unaryFilter:{field:ma(t.field),op:"IS_NOT_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ma(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ma(t.field),op:(e=t.op,ta[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:ma((t=t).field),direction:(t=t.dir,Zs[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.I||pi(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=ga(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ga(e.endAt)),n}function ya(t){var e=4===(o=sa(t.parent)).length?Jr.emptyPath():la(o),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Fr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[_a(t)]:void 0!==t.fieldFilter?[ba(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):xr():[]}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new lo(wa((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=pi(a="object"==typeof(a=n.limit)?a.value:a)?null:a);var s=null;n.startAt&&(s=va(n.startAt));var a=null;return n.endAt&&(a=va(n.endAt)),new yo(e,i,t,o,r,"F",s,a)}function ga(t){return{before:t.before,values:t.position}}function va(t){var e=!!t.before,t=t.values||[];return new oo(t,e)}function ma(t){return{fieldPath:t.canonicalString()}}function wa(t){return Zr.fromServerFormat(t.fieldPath)}function ba(t){return Ui.create(wa(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return xr()}}(),t.fieldFilter.value)}function _a(t){switch(t.unaryFilter.op){case"IS_NAN":var e=wa(t.unaryFilter.field);return Ui.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=wa(t.unaryFilter.field);return Ui.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=wa(t.unaryFilter.field);return Ui.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=wa(t.unaryFilter.field);return Ui.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return xr()}}function Ea(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Te=(Aa.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Aa.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Aa),Ta=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ia=(Sa.prototype.catch=function(t){return this.next(void 0,t)},Sa.prototype.next=function(r,i){var o=this;return this.callbackAttached&&xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Sa(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Sa.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Sa.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Sa?e:Sa.resolve(e)}catch(t){return Sa.reject(t)}},Sa.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Sa.resolve(e)},Sa.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Sa.reject(e)},Sa.resolve=function(n){return new Sa(function(t,e){t(n)})},Sa.reject=function(n){return new Sa(function(t,e){e(n)})},Sa.waitFor=function(t){return new Sa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Sa.or=function(t){for(var n=Sa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Sa.resolve(t):e()})}(r[e]);return n},Sa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Sa);function Sa(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function Aa(){this.onCommittedListeners=[]}function Na(t){return"IndexedDbTransactionError"===t.name}function Da(t){this.Lt=t}var Ra=(Pa.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof ss?(s=r,a=i,h=(o=n).value.clone(),o=ls(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof as?(o=r,s=i,ts((a=n).precondition,o)?(h=ls(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(hs(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Pa.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&es(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&es(r,t,this.localWriteTime)},Pa.prototype.applyToLocalDocumentSet=function(n){var r=this;this.mutations.forEach(function(t){var e=n.get(t.key),t=e;r.applyToLocalView(t),e.isValidDocument()||t.convertToNoDocument(Gr.min())})},Pa.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Vs())},Pa.prototype.isEqual=function(t){return this.batchId===t.batchId&&Br(this.mutations,t.mutations,ns)&&Br(this.baseMutations,t.baseMutations,ns)},Pa),Ca=(La.from=function(t,e,n){Fr(t.mutations.length===n.length);for(var r=xs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new La(t,e,n,r)},La),ka=(Oa.prototype.withSequenceNumber=function(t){return new Oa(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Oa.prototype.withResumeToken=function(t,e){return new Oa(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Oa.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Oa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Oa);function Oa(t,e,n,r,i,o,s){void 0===i&&(i=Gr.min()),void 0===o&&(o=Gr.min()),void 0===s&&(s=ei.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function La(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Pa(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Ma(t){var e=ya({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Io(e,e.limit,"L"):e}var xa=(Ba.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ia.resolve()},Ba.prototype.getCollectionParents=function(t,e){return Ia.resolve(this.Bt.getEntries(e))},Ba),Fa=(qa.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Cs(Jr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},qa.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},qa.prototype.getEntries=function(t){return(this.index[t]||new Cs(Jr.comparator)).toArray()},qa),Va=(Ua.prototype.next=function(){return this.Ht+=2,this.Ht},Ua.Jt=function(){return new Ua(0)},Ua.Yt=function(){return new Ua(-1)},Ua);function Ua(t){this.Ht=t}function qa(){this.index={}}function Ba(){this.Bt=new Fa}function ja(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;return Or("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ga(t,e){this.progress=t,this.wn=e}var Ka=(tu.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},tu.prototype.has=function(t){return void 0!==this.get(t)},tu.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},tu.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},tu.prototype.forEach=function(s){Wr(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},tu.prototype.isEmpty=function(){return zr(this.inner)},tu),_=(Za.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Gr.min()},Za.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},Za.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ki.newInvalidDocument(t),readTime:e})},Za.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ia.resolve(n.document):this.getFromCache(t,e)},Za.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Za.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Za.prototype.assertNotApplied=function(){},Za),Ha=($a.prototype.mn=function(e,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.yn(e,n,t)})},$a.prototype.yn=function(t,e,r){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,n=r;e<n.length;e++)n[e].applyToLocalView(t);return t})},$a.prototype.gn=function(t,i){t.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)})},$a.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},$a.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},$a.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,yi.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):_o(e)?this.In(t,e,n):this.An(t,e,n);var r},$a.prototype.Tn=function(t,e){return this.mn(t,new yi(e)).next(function(t){var e=Ms;return e=t.isFoundDocument()?e.insert(t.key,t):e})},$a.prototype.In=function(n,r,i){var o=this,s=r.collectionGroup,a=Ms;return this.Ut.getCollectionParents(n,s).next(function(t){return Ia.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new yo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.An(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},$a.prototype.An=function(e,n,t){var c,h,r=this;return this.Ue.getDocumentsMatchingQuery(e,n,t).next(function(t){return c=t,r._n.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return h=t,r.Rn(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a);null==u&&(u=ki.newInvalidDocument(a),c=c.insert(a,u)),es(s,u,r.localWriteTime),u.isFoundDocument()||(c=c.remove(a))}})}).next(function(){return c.forEach(function(t,e){Do(n,e)||(c=c.remove(t))}),c})},$a.prototype.Rn=function(t,e,n){for(var r=Vs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof as&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},$a),Qa=(Ja.Pn=function(t,e){for(var n=Vs(),r=Vs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Ja(t,e.fromCache,n,r)},Ja),Wa=(Xa.prototype.Vn=function(t){this.Sn=t},Xa.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Gr.min())?this.Dn(e,r):this.Sn.pn(e,o).next(function(t){var n=s.Cn(r,t);return(vo(r)||mo(r))&&s.Nn(r.limitType,n,o,i)?s.Dn(e,r):(kr()<=f.DEBUG&&Or("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),No(r)),s.Sn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},Xa.prototype.Cn=function(n,t){var r=new Cs(Ro(n));return t.forEach(function(t,e){Do(n,e)&&(r=r.add(e))}),r},Xa.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},Xa.prototype.Dn=function(t,e){return kr()<=f.DEBUG&&Or("QueryEngine","Using full collection scan to execute query:",No(e)),this.Sn.getDocumentsMatchingQuery(t,e,Gr.min())},Xa),za=(Ya.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Fn)})},Ya);function Ya(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ts(qr),this.kn=new Ka(Mi,xi),this.On=Gr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ha(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}function Xa(){}function Ja(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function $a(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function Za(){this.changes=new Ka(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function tu(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function eu(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i)._n,m=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var v;return e._n.getAllMutationBatches(g).next(function(t){return v=t,n=e.persistence.getMutationQueue(o),m=new Ha(e.$n,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Vs(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.pn(g,r).next(function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e._n=n,e.Mn=m,e.xn.Vn(e.Mn),r)]}})})}function nu(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.$n.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=Ia.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=i.docVersions.get(n);Fr(null!==e),t.version.compareTo(e)<0&&(s.applyToRemoteDocument(t,i),t.isValidDocument()&&o.addEntry(t,i.commitVersion))})}),a.next(function(){return e._n.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l._n.performConsistencyCheck(t)}).next(function(){return l.Mn.pn(t,u)})})}function ru(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function iu(t,r){var u=t,c=r.snapshotVersion,h=u.Fn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.$n.newChangeBuffer({trackRemovals:!0});h=u.Fn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Fr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,n))))});var e,n=Os;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(ou(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Gr.min())||(e=u.qe.getLastRemoteSnapshotVersion(s).next(function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),Ia.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Mn.En(s,n)}).next(function(){return n})}).then(function(t){return u.Fn=h,t})}function ou(t,s,e,a,u){var n=Vs();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Os;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e.isNoDocument()&&e.version.isEqual(Gr.min())?(s.removeEntry(t,r),o=o.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):Or("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function su(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qe.getTargetData(e,r).next(function(t){return t?(n=t,Ia.resolve(n)):i.qe.allocateTargetId(e).next(function(t){return n=new ka(r,t,0,e.currentSequenceNumber),i.qe.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Fn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Fn=i.Fn.insert(t.targetId,t),i.kn.set(r,t.targetId)),t})}function au(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Fn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Na(r=t.sent()))throw r;return Or("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Fn=e.Fn.remove(o),e.kn.delete(n.target),[2]}})})}function uu(t,o,s){var a=t,u=Gr.min(),c=Vs();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=To(o),(void 0!==(t=(i=t).kn.get(r))?Ia.resolve(i.Fn.get(t)):i.qe.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.xn.getDocumentsMatchingQuery(e,o,s?u:Gr.min(),s?c:Vs())}).next(function(t){return{documents:t,Bn:c}});var t,n,r,i})}var cu,hu,lu=(Ou.prototype.getBundleMetadata=function(t,e){return Ia.resolve(this.Kn.get(e))},Ou.prototype.saveBundleMetadata=function(t,e){return this.Kn.set(e.id,{id:e.id,version:e.version,createTime:ia(e.createTime)}),Ia.resolve()},Ou.prototype.getNamedQuery=function(t,e){return Ia.resolve(this.jn.get(e))},Ou.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:Ma(e.bundledQuery),readTime:ia(e.readTime)}),Ia.resolve()},Ou),fu=(ku.prototype.isEmpty=function(){return this.Wn.isEmpty()},ku.prototype.addReference=function(t,e){e=new pu(t,e);this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},ku.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},ku.prototype.removeReference=function(t,e){this.Yn(new pu(t,e))},ku.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},ku.prototype.Zn=function(t){var e=this,n=new yi(new Jr([])),r=new pu(n,t),t=new pu(n,t+1),i=[];return this.zn.forEachInRange([r,t],function(t){e.Yn(t),i.push(t.key)}),i},ku.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},ku.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},ku.prototype.es=function(t){var e=new yi(new Jr([])),n=new pu(e,t),t=new pu(e,t+1),r=Vs();return this.zn.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},ku.prototype.containsKey=function(t){var e=new pu(t,0),e=this.Wn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},ku),pu=(Cu.Gn=function(t,e){return yi.comparator(t.key,e.key)||qr(t.ns,e.ns)},Cu.Hn=function(t,e){return qr(t.ns,e.ns)||yi.comparator(t.key,e.key)},Cu),du=(Ru.prototype.checkEmpty=function(t){return Ia.resolve(0===this._n.length)},Ru.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new Ra(i,e,n,r);this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new pu(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return Ia.resolve(n)},Ru.prototype.lookupMutationBatch=function(t,e){return Ia.resolve(this.os(e))},Ru.prototype.getNextMutationBatchAfterBatchId=function(t,e){e+=1,e=this.cs(e),e=e<0?0:e;return Ia.resolve(this._n.length>e?this._n[e]:null)},Ru.prototype.getHighestUnacknowledgedBatchId=function(){return Ia.resolve(0===this._n.length?-1:this.ss-1)},Ru.prototype.getAllMutationBatches=function(t){return Ia.resolve(this._n.slice())},Ru.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new pu(e,0),e=new pu(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([r,e],function(t){t=n.os(t.ns);i.push(t)}),Ia.resolve(i)},Ru.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Cs(qr);return e.forEach(function(t){var e=new pu(t,0),t=new pu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,t],function(t){r=r.add(t.ns)})}),Ia.resolve(this.us(r))},Ru.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;yi.isDocumentKey(e)||(e=e.child(""));var e=new pu(new yi(e),0),i=new Cs(qr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),Ia.resolve(this.us(i))},Ru.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){t=e.os(t);null!==t&&n.push(t)}),n},Ru.prototype.removeMutationBatch=function(n,r){var i=this;Fr(0===this.hs(r.batchId,"removed")),this._n.shift();var o=this.rs;return Ia.forEach(r.mutations,function(t){var e=new pu(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.rs=o})},Ru.prototype.Gt=function(t){},Ru.prototype.containsKey=function(t,e){var n=new pu(e,0),n=this.rs.firstAfterOrEqual(n);return Ia.resolve(e.isEqual(n&&n.key))},Ru.prototype.performConsistencyCheck=function(t){return this._n.length,Ia.resolve()},Ru.prototype.hs=function(t,e){return this.cs(t)},Ru.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},Ru.prototype.os=function(t){t=this.cs(t);return t<0||t>=this._n.length?null:this._n[t]},Ru),yu=(Du.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:i,readTime:n}),this.size+=i-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Du.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Du.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ia.resolve(n?n.document.clone():ki.newInvalidDocument(e))},Du.prototype.getEntries=function(t,e){var n=this,r=Os;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ki.newInvalidDocument(t))}),Ia.resolve(r)},Du.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Os,i=new yi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.document,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||Do(e,s)&&(r=r.insert(s.key,s.clone()))}return Ia.resolve(r)},Du.prototype.fs=function(t,e){return Ia.forEach(this.docs,function(t){return e(t)})},Du.prototype.newChangeBuffer=function(t){return new gu(this)},Du.prototype.getSize=function(t){return Ia.resolve(this.size)},Du),gu=(n(Nu,hu=_),Nu.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e.document.isValidDocument()?i.push(r.Ie.addEntry(n,e.document,r.getReadTime(t))):r.Ie.removeEntry(t)}),Ia.waitFor(i)},Nu.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Nu.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Nu),vu=(Au.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(t,e){return n(e)}),Ia.resolve()},Au.prototype.getLastRemoteSnapshotVersion=function(t){return Ia.resolve(this.lastRemoteSnapshotVersion)},Au.prototype.getHighestSequenceNumber=function(t){return Ia.resolve(this.ws)},Au.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ia.resolve(this.highestTargetId)},Au.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ia.resolve()},Au.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Va(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},Au.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ia.resolve()},Au.prototype.updateTargetData=function(t,e){return this.te(e),Ia.resolve()},Au.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,Ia.resolve()},Au.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.ds.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.ds.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),Ia.waitFor(a).next(function(){return s})},Au.prototype.getTargetCount=function(t){return Ia.resolve(this.targetCount)},Au.prototype.getTargetData=function(t,e){e=this.ds.get(e)||null;return Ia.resolve(e)},Au.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ia.resolve()},Au.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Ia.waitFor(i)},Au.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ia.resolve()},Au.prototype.getMatchingKeysForTargetId=function(t,e){e=this._s.es(e);return Ia.resolve(e)},Au.prototype.containsKey=function(t,e){return Ia.resolve(this._s.containsKey(e))},Au),mu=(Su.prototype.start=function(){return Promise.resolve()},Su.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Su.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Su.prototype.setDatabaseDeletedListener=function(){},Su.prototype.setNetworkEnabled=function(){},Su.prototype.getIndexManager=function(){return this.Ut},Su.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new du(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Su.prototype.getTargetCache=function(){return this.qe},Su.prototype.getRemoteDocumentCache=function(){return this.Ue},Su.prototype.getBundleCache=function(){return this.Qe},Su.prototype.runTransaction=function(t,e,n){var r=this;Or("MemoryPersistence","Starting transaction:",t);var i=new wu(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Su.prototype.Is=function(e,n){return Ia.or(Object.values(this.gs).map(function(t){return function(){return t.containsKey(e,n)}}))},Su),wu=(n(Iu,cu=Te),Iu),bu=(Tu.bs=function(t){return new Tu(t)},Object.defineProperty(Tu.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw xr()},enumerable:!1,configurable:!0}),Tu.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ia.resolve()},Tu.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ia.resolve()},Tu.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ia.resolve()},Tu.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Tu.prototype.Es=function(){this.Rs=new Set},Tu.prototype.Ts=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ia.forEach(this.vs,function(t){var e=yi.fromPath(t);return r.Ps(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Rs=null,i.apply(n)})},Tu.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},Tu.prototype.ps=function(t){return 0},Tu.prototype.Ps=function(t,e){var n=this;return Ia.or([function(){return Ia.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Tu),_u=(Eu.prototype.isAuthenticated=function(){return null!=this.uid},Eu.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Eu.prototype.isEqual=function(t){return t.uid===this.uid},Eu);function Eu(t){this.uid=t}function Tu(t){this.persistence=t,this.As=new fu,this.Rs=null}function Iu(t){var e=this;return(e=cu.call(this)||this).currentSequenceNumber=t,e}function Su(t,e){var n=this;this.gs={},this.Ne=new Ir(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new vu(this),this.Ut=new xa,this.Ue=(t=this.Ut,new yu(t,function(t){return n.referenceDelegate.ps(t)})),this.R=new Da(e),this.Qe=new lu(this.R)}function Au(t){this.persistence=t,this.ds=new Ka(Mi,xi),this.lastRemoteSnapshotVersion=Gr.min(),this.highestTargetId=0,this.ws=0,this._s=new fu,this.targetCount=0,this.ys=Va.Jt()}function Nu(t){var e=this;return(e=hu.call(this)||this).Ie=t,e}function Du(t,e){this.Ut=t,this.ls=e,this.docs=new Ts(yi.comparator),this.size=0}function Ru(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Cs(pu.Gn)}function Cu(t,e){this.key=t,this.ns=e}function ku(){this.Wn=new Cs(pu.Gn),this.zn=new Cs(pu.Hn)}function Ou(t){this.R=t,this.Kn=new Map,this.jn=new Map}_u.UNAUTHENTICATED=new _u(null),_u.GOOGLE_CREDENTIALS=new _u("google-credentials-uid"),_u.FIRST_PARTY=new _u("first-party-uid");var Lu,Pu=(Wu.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Wu.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Wu.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},Wu),Mu=(Qu.prototype.addPendingMutation=function(t){},Qu.prototype.updateMutationState=function(t,e,n){},Qu.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},Qu.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},Qu.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},Qu.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},Qu.prototype.clearQueryState=function(t){delete this.fi[t]},Qu.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},Qu.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},Qu.prototype.start=function(){return this.li=new Pu,Promise.resolve()},Qu.prototype.handleUserChange=function(t,e,n){},Qu.prototype.setOnlineState=function(t){},Qu.prototype.shutdown=function(){},Qu.prototype.writeSequenceNumber=function(t){},Qu.prototype.notifyBundleLoaded=function(){},Qu),xu=(Hu.prototype.di=function(t){},Hu.prototype.shutdown=function(){},Hu),Fu=(Ku.prototype.di=function(t){this.gi.push(t)},Ku.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},Ku.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},Ku.prototype._i=function(){Or("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},Ku.prototype.yi=function(){Or("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},Ku.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Ku),Vu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Uu=(Gu.prototype.Ii=function(t){this.Ai=t},Gu.prototype.Ri=function(t){this.bi=t},Gu.prototype.onMessage=function(t){this.vi=t},Gu.prototype.close=function(){this.Ti()},Gu.prototype.send=function(t){this.Ei(t)},Gu.prototype.Pi=function(){this.Ai()},Gu.prototype.Vi=function(t){this.bi(t)},Gu.prototype.Si=function(t){this.vi(t)},Gu),qu=(ju.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);Or("RestConnection","Sending: ",i,n);t={};return this.Fi(t,r),this.ki(e,i,t,n).then(function(t){return Or("RestConnection","Received: ",t),t},function(t){throw Pr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},ju.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},ju.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.2",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},ju.prototype.xi=function(t,e){t=Vu[t];return this.Di+"/v1/"+e+":"+t},n(Bu,Lu=ju),Bu.prototype.ki=function(o,e,s,a){return new Promise(function(n,r){var i=new Tr;i.listenOnce(mr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case vr.NO_ERROR:var t=i.getResponseJson();Or("Connection","XHR received:",JSON.stringify(t)),n(t);break;case vr.TIMEOUT:Or("Connection",'RPC "'+o+'" timed out'),r(new Dr(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var e=i.getStatus();Or("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Nr).indexOf(e)?e:Nr.UNKNOWN,r(new Dr(e,t.message))):r(new Dr(Nr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Dr(Nr.UNAVAILABLE,"Connection failed."));break;default:xr()}}finally{Or("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);i.send(e,"POST",t,s,15)})},Bu.prototype.$i=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new lr,o=gr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=h().indexOf("Electron/")||(0<=(n=h()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=h().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Or("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new Uu({Ei:function(t){u?Or("Connection","Not sending because WebChannel is closed:",t):(a||(Or("Connection","Opening WebChannel transport."),s.open(),a=!0),Or("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Er.EventType.OPEN,function(){u||Or("Connection","WebChannel transport opened.")}),t(s,Er.EventType.CLOSE,function(){u||(u=!0,Or("Connection","WebChannel transport closed"),c.Vi())}),t(s,Er.EventType.ERROR,function(t){u||(u=!0,Pr("Connection","WebChannel transport errored:",t),c.Vi(new Dr(Nr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Er.EventType.MESSAGE,function(t){var e,n,r,i;u||(Fr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Or("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=ds[r];if(void 0!==t)return Es(t)}(),i=n.message,void 0===t&&(t=Nr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Dr(t,i)),s.close()):(Or("Connection","WebChannel received:",e),c.Si(e)))}),t(o,wr.STAT_EVENT,function(t){t.stat===br?Or("Connection","Detected buffering proxy"):t.stat===_r&&Or("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Pi()},0),c},Bu);function Bu(t){var e=this;return(e=Lu.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e}function ju(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function Gu(t){this.Ei=t.Ei,this.Ti=t.Ti}function Ku(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function Hu(){}function Qu(){this.li=new Pu,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function Wu(){this.activeTargetIds=Us}function zu(){return"undefined"!=typeof document?document:null}function Yu(t){return new ea(t,!0)}function Xu(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return wc(this)?(Or("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).$r.add(4),[4,fc(e)];case 1:return t.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,lc(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new ic(n,r)}var Ju,$u,Zu,tc=(hc.prototype.reset=function(){this.qi=0},hc.prototype.Ki=function(){this.qi=this.Bi},hc.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);0<i&&Or("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},hc.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},hc.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},hc.prototype.Wi=function(){return(Math.random()-.5)*this.qi},hc),_=(cc.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},cc.prototype.er=function(){return 2===this.state},cc.prototype.start=function(){3!==this.state?this.auth():this.nr()},cc.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},cc.prototype.sr=function(){this.state=0,this.Zi.reset()},cc.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},cc.prototype.cr=function(t){this.ur(),this.stream.send(t)},cc.prototype.rr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},cc.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},cc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Lr(n.toString()),Lr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):n&&n.code===Nr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(n)];case 1:return t.sent(),[2]}})})},cc.prototype.ar=function(){},cc.prototype.auth=function(){var n=this;this.state=1;var t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(function(t){n.Yi===e&&n.lr(t)},function(e){t(function(){var t=new Dr(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.dr(t)})})},cc.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},cc.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},cc.prototype.dr=function(t){return Or("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},cc.prototype.hr=function(e){var n=this;return function(t){n.Se.enqueueAndForget(function(){return n.Yi===e?t():(Or("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},cc),ec=(n(uc,Zu=_),uc.prototype.wr=function(t){return this.Hi.$i("Listen",t)},uc.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:xr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(Fr(void 0===s||"string"==typeof s),ei.fromBase64String(s||"")):(Fr(void 0===s||s instanceof Uint8Array),ei.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Nr.UNKNOWN:Es(c.code),new Dr(u,c.message||"")),s=new Ks(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=ua(t,n.document.name),i=ia(n.document.updateTime),a=new Ri({mapValue:{fields:n.document.fields}}),u=(o=ki.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new js(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=ua(t,n.document),i=n.readTime?ia(n.readTime):Gr.min(),a=ki.newNoDocument(r,i),o=n.removedTargetIds||[],s=new js([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=ua(t,n.document),i=n.removedTargetIds||[],s=new js([],i,r,null);else{if(!("filter"in e))return xr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new ps(n),i=e.targetId,s=new Gs(i,r)}return s}(this.R,t),t=function(t){if(!("targetChange"in t))return Gr.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?ia(t.readTime):Gr.min()}(t);return this.listener._r(e,t)},uc.prototype.mr=function(t){var e,n,r,i={};i.database=ha(this.R),i.addTarget=(e=this.R,(r=Fi(r=(n=t).target)?{documents:{documents:[ca(e,r.path)]}}:{query:da(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ra(e,n.resumeToken):0<n.snapshotVersion.compareTo(Gr.min())&&(r.readTime=na(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.R,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return xr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.cr(i)},uc.prototype.yr=function(t){var e={};e.database=ha(this.R),e.removeTarget=t,this.cr(e)},uc),nc=(n(ac,$u=_),Object.defineProperty(ac.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),ac.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,$u.prototype.start.call(this)},ac.prototype.ar=function(){this.gr&&this.Er([])},ac.prototype.wr=function(t){return this.Hi.$i("Write",t)},ac.prototype.onMessage=function(t){if(Fr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Fr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?ia(e.updateTime):ia(n)).isEqual(Gr.min())&&(t=ia(n)),new Jo(t,e.transformResults||[]);var e,n})):[]),n=ia(t.commitTime);return this.listener.Tr(n,e)}var n,r;return Fr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},ac.prototype.Ar=function(){var t={};t.database=ha(this.R),this.cr(t)},ac.prototype.Er=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return pa(e.R,t)})};this.cr(t)},ac),rc=(n(sc,Ju=function(){}),sc.prototype.br=function(){if(this.Rr)throw new Dr(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},sc.prototype.Ni=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Ni(e,n,r,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},sc.prototype.Oi=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Oi(e,n,r,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},sc.prototype.terminate=function(){this.Rr=!1},sc),ic=(oc.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},oc.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},oc.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},oc.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},oc.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Lr(t),this.Vr=!1):Or("OnlineStateTracker",t)},oc.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},oc);function oc(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function sc(t,e,n){var r=this;return(r=Ju.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function ac(t,e,n,r,i){var o=this;return(o=$u.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function uc(t,e,n,r,i){var o=this;return(o=Zu.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function cc(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new tc(t,e)}function hc(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}function lc(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!wc(r))return[3,4];e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function fc(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function pc(t,e){t.Or.has(e.targetId)||(t.Or.set(e.targetId,e),mc(t)?vc(t):Nc(t).er()&&yc(t,e))}function dc(t,e){var n=t,t=Nc(n);n.Or.delete(e),t.er()&&gc(n,e),0===n.Or.size&&(t.er()?t.ir():wc(n)&&n.Br.set("Unknown"))}function yc(t,e){t.qr.U(e.targetId),Nc(t).mr(e)}function gc(t,e){t.qr.U(e),Nc(t).yr(e)}function vc(e){e.qr=new Qs({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.Or.get(t)||null}}),Nc(e).start(),e.Br.Sr()}function mc(t){return wc(t)&&!Nc(t).tr()&&0<t.Or.size}function wc(t){return 0===t.$r.size}function bc(t){t.qr=void 0}function _c(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.Br.set("Online"),!(a instanceof Ks&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Or.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Or.delete(i),o.qr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Or("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Ec(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof js?s.qr.X(a):a instanceof Gs?s.qr.rt(a):s.qr.et(a),u.isEqual(Gr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,ru(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).qr.ut(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.Or.get(e))&&r.Or.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.Or.get(t);e&&(r.Or.set(t,e.withResumeToken(ei.EMPTY_BYTE_STRING,e.snapshotVersion)),gc(r,t),e=new ka(e.target,t,1,e.sequenceNumber),yc(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Or("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Ec(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Ec(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!Na(r))throw r;return n.$r.add(1),[4,fc(n)];case 1:return t.sent(),n.Br.set("Offline"),i=i||function(){return ru(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Or("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.$r.delete(1),[4,lc(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Tc(e,n){return n().catch(function(t){return Ec(e,t,n)})}function Ic(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=Dc(i=u),s=0<i.kr.length?i.kr[i.kr.length-1].batchId:-1,t.label=1;case 1:if(!(wc(i)&&i.kr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r._n.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.kr.length&&o.ir(),[3,7]):(s=a.batchId,function(t,e){t.kr.push(e);t=Dc(t);t.er()&&t.pr&&t.Er(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,Ec(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Sc(i)&&Ac(i),[2]}var e,n,r})})}function Sc(t){return wc(t)&&!Dc(t).tr()&&0<t.kr.length}function Ac(t){Dc(t).start()}function Nc(n){var t,e,r,i=this;return n.Ur||(n.Ur=(t=n.datastore,e=n.asyncQueue,r={Ii:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.Or.forEach(function(t,e){yc(n,t)}),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return bc(e),mc(e)?(e.Br.Nr(n),vc(e)):e.Br.set("Unknown"),[2]})})}.bind(null,n),_r:_c.bind(null,n)},t.br(),new ec(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Ur.sr(),mc(n)?vc(n):n.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Ur.stop()];case 2:t.sent(),bc(n),t.label=3;case 3:return[2]}})})})),n.Ur}function Dc(n){var t,e,r,i=this;return n.Qr||(n.Qr=(t=n.datastore,e=n.asyncQueue,r={Ii:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return Dc(e).Ar(),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&Dc(e).pr?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return _s(n=i.code)&&n!==Nr.ABORTED?(e=r.kr.shift(),Dc(r).sr(),[4,Tc(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Ic(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Sc(e)&&Ac(e),[2]}})})}.bind(null,n),Ir:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=Dc(o),n=0,r=o.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}.bind(null,n),Tr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.kr.shift(),n=Ca.from(e,i,o),[4,Tc(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Ic(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.br(),new nc(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Qr.sr(),[4,Ic(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Qr.stop()];case 3:t.sent(),0<n.kr.length&&(Or("RemoteStore","Stopping write stream with "+n.kr.length+" pending writes"),n.kr=[]),t.label=4;case 4:return[2]}})})})),n.Qr}var Rc=(Cc.createAndSchedule=function(t,e,n,r,i){i=new Cc(t,e,Date.now()+n,r,i);return i.start(n),i},Cc.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Cc.prototype.skipDelay=function(){return this.handleDelayElapsed()},Cc.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Dr(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Cc.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Cc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Cc);function Cc(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ta,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function kc(t,e){if(Lr("AsyncQueue",e+": "+t),Na(t))return new Dr(Nr.UNAVAILABLE,e+": "+t);throw t}function Oc(){this.queries=new Ka(Ao,So),this.onlineState="Unknown",this.Gr=new Set}var Lc=(Uc.emptySet=function(t){return new Uc(t.comparator)},Uc.prototype.has=function(t){return null!=this.keyedMap.get(t)},Uc.prototype.get=function(t){return this.keyedMap.get(t)},Uc.prototype.first=function(){return this.sortedSet.minKey()},Uc.prototype.last=function(){return this.sortedSet.maxKey()},Uc.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},Uc.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(Uc.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),Uc.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},Uc.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},Uc.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},Uc.prototype.isEqual=function(t){if(!(t instanceof Uc))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},Uc.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Uc.prototype.copy=function(t,e){var n=new Uc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},Uc),Pc=(Vc.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);!n||0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):xr()},Vc.prototype.jr=function(){var n=[];return this.Kr.inorderTraversal(function(t,e){n.push(e)}),n},Vc),Mc=(Fc.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Fc(t,e,Lc.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(Fc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Fc.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&So(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Fc),xc=function(){this.Wr=void 0,this.listeners=[]};function Fc(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Vc(){this.Kr=new Ts(yi.comparator)}function Uc(n){this.comparator=n?function(t,e){return n(t,e)||yi.comparator(t.key,e.key)}:function(t,e){return yi.comparator(t.key,e.key)},this.keyedMap=Ms,this.sortedSet=new Ts(this.comparator)}function qc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new xc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Wr=t.sent(),[3,4];case 3:return o=t.sent(),o=kc(o,"Initialization of query '"+No(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.zr(e.onlineState),i.Wr&&a.Hr(i.Wr)&&jc(e),[2]}})})}function Bc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function jc(t){t.Gr.forEach(function(t){t.next()})}var Gc=(Xc.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Mc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},Xc.prototype.onError=function(t){this.Jr.error(t)},Xc.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},Xc.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},Xc.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},Xc.prototype.no=function(t){t=Mc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},Xc),Kc=(Yc.prototype.io=function(){return"metadata"in this.payload},Yc),Hc=(zc.prototype.qn=function(t){return ua(this.R,t)},zc.prototype.Un=function(t){return t.metadata.exists?(e=this.R,n=t.document,r=ua(e,n.name),e=ia(n.updateTime),n=new Ri({mapValue:{fields:n.fields}}),n=ki.newFoundDocument(r,e,n)):ki.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime));var e,n,r},zc.prototype.Qn=ia,zc),Qc=(Wc.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Wc.prototype.co=function(t){for(var e=new Map,n=new Hc(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Vs()).add(s);e.set(c,h)}}return e},Wc.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Vs(),i=Os,o=xs,e=0,s=p;e<s.length;e++)a=s[e],u=f.qn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.Un(a)),o=o.insert(u,f.Qn(a.metadata.readTime));return c=n.$n.newChangeBuffer({trackRemovals:!0}),[4,su(n,To(go(Jr.fromString("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return ou(e,c,i,Gr.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.qe.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.qe.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Mn.En(e,t)}).next(function(){return t})})})]}})})}(this.localStore,new Hc(this.R),this.documents,this.ro.id)];case 1:e=t.sent(),n=this.co(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Vs()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,su(e,To(Ma(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ia(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.Qe.saveNamedQuery(t,i);e=n.withResumeToken(ei.EMPTY_BYTE_STRING,e);return r.Fn=r.Fn.insert(e.targetId,e),r.qe.updateTargetData(t,e).next(function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.qe.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.Qe.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Ga(Object.assign({},this.progress),e))]}})})},Wc);function Wc(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Jc(t)}function zc(t){this.R=t}function Yc(t,e){this.payload=t,this.byteLength=e}function Xc(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function Jc(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var $c=function(t){this.key=t},Zc=function(t){this.key=t},th=(Object.defineProperty(oh.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),oh.prototype._o=function(t,e){var s=this,a=e?e.mo:new Pc,u=(e||this).fo,c=(e||this).mutatedKeys,h=u,l=!1,f=vo(this.query)&&u.size===this.query.limit?u.last():null,p=mo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=Do(s.query,e)?e:null,i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(a.track({type:3,doc:r}),e=!0):s.yo(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.lo(r,f)||p&&s.lo(r,p)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),vo(this.query)||mo(this.query))for(;h.size>this.query.limit;){var n=vo(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{fo:h,mo:a,Nn:l,mutatedKeys:c}},oh.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},oh.prototype.applyChanges=function(t,e,n){var o=this,r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xr()}}var r,i}),this.po(n);var s=e?this.Eo():[],n=0===this.ho.size&&this.current?1:0,e=n!==this.ao;return this.ao=n,0!==i.length||e?{snapshot:new Mc(this.query,t.fo,r,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},oh.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Pc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},oh.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},oh.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},oh.prototype.Eo=function(){var e=this;if(!this.current)return[];var n=this.ho;this.ho=Vs(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var r=[];return n.forEach(function(t){e.ho.has(t)||r.push(new Zc(t))}),this.ho.forEach(function(t){n.has(t)||r.push(new $c(t))}),r},oh.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Vs();t=this._o(t.documents);return this.applyChanges(t,!0)},oh.prototype.Ro=function(){return Mc.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},oh),eh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},nh=function(t){this.key=t,this.bo=!1},rh=(Object.defineProperty(ih.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),ih);function ih(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Ka(Ao,So),this.Vo=new Map,this.So=new Set,this.Do=new Ts(yi.comparator),this.Co=new Map,this.No=new fu,this.xo={},this.Fo=new Map,this.ko=Va.Yt(),this.onlineState="Unknown",this.Oo=void 0}function oh(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Vs(),this.mutatedKeys=Vs(),this.lo=Ro(t),this.fo=new Lc(this.lo)}function sh(a,u){return y(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(t){switch(t.label){case 0:return(e=a).remoteStore.remoteSyncer.applyRemoteEvent=uh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t,t=n.Co.get(e);if(t&&t.bo)return Vs().add(t.key);var r=Vs(),e=n.Vo.get(e);if(!e)return r;for(var i=0,o=e;i<o.length;i++){var s=o[i],s=n.Po.get(s);r=r.unionWith(s.view.wo)}return r}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Ts(yi.comparator)).insert(n,ki.newNoDocument(n,Gr.min())),i=Vs().add(n),i=new qs(Gr.min(),new Map,new Cs(qr),r,i),[4,uh(e,i)]):[3,2];case 1:return t.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),gh(e),[3,4];case 2:return[4,au(e.localStore,s,!1).then(function(){return ph(e,s,a)}).catch(ja)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&jc(n)}.bind(null,e.eventManager),e.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,e.eventManager),(s=(n=e).Po.get(u))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro(),[3,4]):[3,1];case 1:return[4,su(n.localStore,To(u))];case 2:return o=t.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.$o=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view._o(o)).Nn?[4,uu(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view._o(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(yh(r,i.targetId,n.To),n.snapshot)]}})})}(i,t,e,n)},[4,uu(i.localStore,o,!0)];case 1:return n=t.sent(),r=new th(o,n.Bn),e=r._o(n.documents),n=Bs.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),yh(i,s,n.To),r=new eh(o,s,r),[2,(i.Po.set(o,r),i.Vo.has(s)?i.Vo.get(s).push(o):i.Vo.set(s,[o]),n.snapshot)]}})})}(n,u,r,"current"===s)];case 3:i=t.sent(),n.isPrimaryClient&&pc(n.remoteStore,o),t.label=4;case 4:return[2,i]}var e})})}function ah(f,p,d){return y(this,void 0,void 0,function(){var s,l;return g(this,function(t){switch(t.label){case 0:(o=f).remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,nu(e.localStore,o)];case 2:return r=t.sent(),fh(e,n,null),lh(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,vh(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,o),o.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i._n.lookupMutationBatch(e,r).next(function(t){return Fr(null!==t),n=t.keys(),i._n.removeMutationBatch(e,t)}).next(function(){return i._n.performConsistencyCheck(e)}).next(function(){return i.Mn.pn(e,n)})}))];case 2:return o=t.sent(),fh(n,a,u),lh(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,vh(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,o),l=o,t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(r=l.localStore,a=p,c=r,h=jr.now(),i=a.reduce(function(t,e){return t.add(e.key)},Vs()),c.persistence.runTransaction("Locally write mutations","readwrite",function(s){return c.Mn.pn(s,i).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),s=Lo(o.transform,s||null);null!=s&&(n=null==n?Ri.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new as(i.key,o,function s(t){var a=[];return Wr(t.fields||{},function(t,e){var n=new Zr([t]);if(Di(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new ti(a)}(o.toProto().mapValue),$o.exists(!0)))}return c._n.addMutationBatch(s,h,e,a)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return s=t.sent(),l.sharedClientState.addPendingMutation(s.batchId),e=l,n=s.batchId,o=d,r=(r=(r=e.xo[e.currentUser.toKey()])||new Ts(qr)).insert(n,o),e.xo[e.currentUser.toKey()]=r,[4,vh(l,s.changes)];case 3:return t.sent(),[4,Ic(l.remoteStore)];case 4:return t.sent(),[3,6];case 5:return l=t.sent(),l=kc(l,"Failed to persist write"),d.reject(l),[3,6];case 6:return[2]}var e,n,r,a,u,c,h,i,o})})}function uh(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,iu(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.Co.get(e);e&&(Fr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?Fr(e.bo):0<t.removedDocuments.size&&(Fr(e.bo),e.bo=!1))}),[4,vh(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function ch(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.Po.forEach(function(t,e){e=e.view.zr(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].zr(i)&&(o=!0)}),o&&jc(t)}(t.eventManager,n),r.length&&t.vo._r(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function hh(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:wc((n=o).remoteStore)||Or("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Fo.get(r)||[]).push(s),n.Fo.set(r,i),[3,4]);case 3:return i=t.sent(),i=kc(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function lh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function fh(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function ph(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||dh(e,t)})}function dh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(dc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),gh(t))}function yh(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof $c?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(Or("SyncEngine","New document in limbo: "+o),r.So.add(i),gh(r))):u instanceof Zc?(Or("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||dh(t,u.key)):xr()}}function gh(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new yi(Jr.fromString(e)),e=t.ko.next();t.Co.set(e,new nh(n)),t.Do=t.Do.insert(n,e),pc(t.remoteStore,new ka(To(go(n.path)),e,2,Ir.o))}}function vh(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Po.isEmpty()?[3,3]:(n.Po.forEach(function(t,e){o.push(n.$o(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Qa.Pn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.vo._r(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ia.forEach(c,function(e){return Ia.forEach(e.bn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return Ia.forEach(e.vn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Na(e=t.sent()))throw e;return Or("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Fn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Fn=r.Fn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function mh(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Or("SyncEngine","User change. New user:",o.toKey()),[4,eu(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Fo.forEach(function(t){t.forEach(function(t){t.reject(new Dr(Nr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,vh(n,r.Ln)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function wh(t,e,n){var r=t;!function(f,p,d){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=ia((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Qe.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return d._updateProgress(Jc(a)),u=new Qc(a,f.localStore,p.R),[4,p.Lo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.oo(c)]:[3,10];case 7:return(h=t.sent())&&d._updateProgress(h),[4,p.Lo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,vh(f,l.wn,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Qe.saveBundleMetadata(t,e)}))];case 13:return t.sent(),d._completeWith(l.progress),[3,15];case 14:return Pr("SyncEngine","Loading bundle failed with "+(l=t.sent())),d._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var bh=(Th.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.R=Yu(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Qo(e),[2]}})})},Th.prototype.Uo=function(t){return null},Th.prototype.Qo=function(t){return e=this.persistence,n=new Wa,r=t.initialUser,t=this.R,new za(e,n,r,t);var e,n,r},Th.prototype.qo=function(t){return new mu(bu.bs,this.R)},Th.prototype.Bo=function(t){return new Mu},Th.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Th),_h=(Eh.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return ch(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=mh.bind(null,this.syncEngine),[4,function(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.$r.delete(2),[4,lc(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.$r.add(2),[4,fc(e)]);case 3:t.sent(),e.Br.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Eh.prototype.createEventManager=function(t){return new Oc},Eh.prototype.createDatastore=function(t){var e=Yu(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new qu(n));return t=t.credentials,new rc(t,n,e)},Eh.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return ch(e.syncEngine,t,0)},t=new(Fu.yt()?Fu:xu);return new Xu(n,r,i,o,t)},Eh.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new rh(t,e,n,r,i,o);return s&&(o.Oo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},Eh.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,Or("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,fc(e)];case 1:return t.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},Eh);function Eh(){}function Th(){this.synchronizeTabs=!1}function Ih(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Sh=(Ph.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Ph.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Ph.prototype.Wo=function(){this.muted=!0},Ph.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Ph),Ah=(Lh.prototype.close=function(){return this.Go.cancel()},Lh.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},Lh.prototype.Lo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},Lh.prototype.Ho=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.Jo()];case 1:return null===(e=t.sent())?[2,null]:(r=this.zo.decode(e),n=Number(r),isNaN(n)&&this.Yo("length string ("+r+") is not valid number"),[4,this.Xo(n)]);case 2:return r=t.sent(),[2,new Kc(JSON.parse(r),e.length+n)]}})})},Lh.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Lh.prototype.Jo=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Lh.prototype.Xo=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.tc()]:[3,3];case 1:t.sent()&&this.Yo("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Lh.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},Lh.prototype.tc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Go.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Lh),Nh=(Oh.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Dr(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=ha((n=s).R)+"/documents",r={documents:a.map(function(t){return aa(n.R,t)})},[4,n.Oi("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.R,"found"in(t=t)?function(t,e){Fr(!!e.found),e.found.name,e.found.updateTime;var n=ua(t,e.found.name),t=ia(e.found.updateTime),e=new Ri({mapValue:{fields:e.found.fields}});return ki.newFoundDocument(n,t,e)}(e,t):"missing"in t?function(t,e){Fr(!!e.missing),Fr(!!e.readTime);t=ua(t,e.missing),e=ia(e.readTime);return ki.newNoDocument(t,e)}(e,t):xr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());Fr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},Oh.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Oh.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},Oh.prototype.delete=function(t){this.write(new vs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Oh.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=yi.fromPath(e);n.mutations.push(new ms(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=ha((e=i).R)+"/documents",r={writes:o.map(function(t){return pa(e.R,t)})},[4,e.Ni("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},Oh.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw xr();e=Gr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Dr(Nr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},Oh.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?$o.updateTime(e):$o.none()},Oh.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return $o.exists(!0);if(e.isEqual(Gr.min()))throw new Dr(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $o.updateTime(e)},Oh.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},Oh.prototype.ensureCommitNotCalled=function(){},Oh),Dh=(kh.prototype.run=function(){this.nc()},kh.prototype.nc=function(){var t=this;this.Zi.ji(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new Nh(this.datastore),(n=this.sc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},kh.prototype.sc=function(t){try{var e=this.updateFunction(t);return!pi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},kh.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},kh.prototype.rc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!_s(t)},kh),Rh=(Ch.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},Ch.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},Ch.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Dr(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},Ch.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Ta;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=kc(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Ch);function Ch(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=_u.UNAUTHENTICATED,this.clientId=Vr.u(),this.credentialListener=function(){},this.receivedInitialUser=new Ta,this.credentials.setChangeListener(function(t){Or("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}function kh(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new tc(this.asyncQueue,"transaction_retry")}function Oh(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Lh(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ta,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Ph(t){this.observer=t,this.muted=!1}function Mh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(Or("FirestoreClient","Using default OfflineComponentProvider"),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),Or("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){n.isEqual(e)||(n=e,i.asyncQueue.enqueueRetryable(function(){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,eu(o.localStore,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}(e,new bh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function xh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(Or("FirestoreClient","Using default OnlineComponentProvider"),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Mh(r)];case 1:return e=t.sent(),Or("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),Or("RemoteStore","RemoteStore received new credentials"),n=wc(e),e.$r.add(3),[4,fc(e)];case 1:return t.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.$r.delete(3),[4,lc(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)})}),r.onlineComponents=i,[2]}})})}(e,new _h)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Fh(t){return Mh(t).then(function(t){return t.persistence})}function Vh(t){return Mh(t).then(function(t){return t.localStore})}function Uh(t){return xh(t).then(function(t){return t.remoteStore})}function qh(t){return xh(t).then(function(t){return t.syncEngine})}function Bh(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,xh(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=sh.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Po.get(o),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter(function(t){return!So(t,o)})),void e.Po.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,au(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),dc(e.remoteStore,n.targetId),ph(e,n.targetId)}).catch(ja)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return ph(e,n.targetId),[4,au(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function jh(n,r,i){var t=this;void 0===i&&(i={});var o=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Sh({next:function(t){r.enqueueAndForget(function(){return Bc(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Dr(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Dr(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new Gc(go(i.path),t,{includeMetadataChanges:!0,so:!0});return qc(n,a)},[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Gh(n,r,i){var t=this;void 0===i&&(i={});var o=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Sh({next:function(t){n.enqueueAndForget(function(){return Bc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Dr(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Gc(t,o,{includeMetadataChanges:!0,so:!0});return qc(e,s)},[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Kh(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Hh=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Qh=(Object.defineProperty(nl.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),nl.prototype.isEqual=function(t){return t instanceof nl&&t.projectId===this.projectId&&t.database===this.database},nl),Wh=new Map,zh=(el.prototype.getToken=function(){return Promise.resolve(null)},el.prototype.invalidateToken=function(){},el.prototype.setChangeListener=function(t){(this.changeListener=t)(_u.UNAUTHENTICATED)},el.prototype.removeChangeListener=function(){this.changeListener=null},el),Yh=(tl.prototype.getToken=function(){var e=this,n=this.cc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.cc!==n?(Or("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Fr("string"==typeof t.accessToken),new Kh(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},tl.prototype.invalidateToken=function(){this.forceRefresh=!0},tl.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},tl.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},tl.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t),new _u(t)},tl),Xh=(Object.defineProperty(Zh.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Zh),Jh=($h.prototype.getToken=function(){return Promise.resolve(new Xh(this.ac,this.hc))},$h.prototype.setChangeListener=function(t){t(_u.FIRST_PARTY)},$h.prototype.removeChangeListener=function(){},$h.prototype.invalidateToken=function(){},$h);function $h(t,e){this.ac=t,this.hc=e}function Zh(t,e){this.ac=t,this.hc=e,this.type="FirstParty",this.user=_u.FIRST_PARTY}function tl(t){var e=this;this.oc=null,this.currentUser=_u.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then(function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)},function(){}))}function el(){this.changeListener=null}function nl(t,e){this.projectId=t,this.database=e||"(default)"}function rl(t,e,n){if(!n)throw new Dr(Nr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function il(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ol(t,e,n,r){if(!0===e&&!0===r)throw new Dr(Nr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function sl(t){if(!yi.isDocumentKey(t))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function al(t){if(yi.isDocumentKey(t))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ul(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":xr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function cl(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Dr(Nr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=ul(t);throw new Dr(Nr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function hl(t,e){if(e<=0)throw new Dr(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ll,fl=(_l.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},_l),pl=(Object.defineProperty(bl.prototype,"app",{get:function(){if(!this._app)throw new Dr(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(bl.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(bl.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),bl.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Dr(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new zh;switch(t.type){case"gapi":var e=t.client;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Jh(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Dr(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},bl.prototype._getSettings=function(){return this._settings},bl.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},bl.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},bl.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},bl.prototype._terminate=function(){return(t=Wh.get(this))&&(Or("ComponentProvider","Removing Datastore"),Wh.delete(this),t.terminate()),Promise.resolve();var t},bl),dl=(Object.defineProperty(wl.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(wl.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(wl.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(wl.prototype,"parent",{get:function(){return new gl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),wl.prototype.withConverter=function(t){return new wl(this.firestore,t,this._key)},wl),yl=(ml.prototype.withConverter=function(t){return new ml(this.firestore,t,this._query)},ml),gl=(n(vl,ll=yl),Object.defineProperty(vl.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(vl.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(vl.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new dl(this.firestore,null,new yi(t))},enumerable:!1,configurable:!0}),vl.prototype.withConverter=function(t){return new vl(this.firestore,t,this._path)},vl);function vl(t,e,n){var r=this;return(r=ll.call(this,t,e,go(n))||this).firestore=t,r._path=n,r.type="collection",r}function ml(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}function wl(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}function bl(t,e){this._persistenceKey="(lite)",this._settings=new fl({}),this._settingsFrozen=!1,t instanceof Qh?(this._databaseId=t,this._credentials=new zh):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Dr(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qh(t.options.projectId)}(t),this._credentials=new Yh(e))}function _l(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Dr(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,ol("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function El(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=v(t),rl("collection","path",e),t instanceof pl)return al(n=Jr.fromString.apply(Jr,s([e],r))),new gl(t,null,n);if(!(t instanceof dl||t instanceof gl))throw new Dr(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return al(n=Jr.fromString.apply(Jr,s([t.path],r)).child(Jr.fromString(e))),new gl(t.firestore,null,n)}function Tl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=v(t),rl("doc","path",e=1===arguments.length?Vr.u():e),t instanceof pl)return sl(n=Jr.fromString.apply(Jr,s([e],r))),new dl(t,null,new yi(n));if(!(t instanceof dl||t instanceof gl))throw new Dr(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return sl(n=t._path.child(Jr.fromString.apply(Jr,s([e],r)))),new dl(t.firestore,t instanceof gl?t._converter:null,new yi(n))}function Il(t,e){return t=v(t),e=v(e),(t instanceof dl||t instanceof gl)&&(e instanceof dl||e instanceof gl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Sl(t,e){return t=v(t),e=v(e),t instanceof yl&&e instanceof yl&&t.firestore===e.firestore&&So(t._query,e._query)&&t._converter===e._converter}var Al=(Object.defineProperty(Nl.prototype,"isShuttingDown",{get:function(){return this.dc},enumerable:!1,configurable:!0}),Nl.prototype.enqueueAndForget=function(t){this.enqueue(t)},Nl.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ec(),this.Tc(t)},Nl.prototype.enterRestrictedMode=function(){var t;this.dc||(this.dc=!0,(t=zu())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.gc))},Nl.prototype.enqueue=function(t){return this.Ec(),this.dc?new Promise(function(t){}):this.Tc(t)},Nl.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.fc.push(t),e.Ic()})},Nl.prototype.Ic=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.fc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.fc[0]()];case 2:return t.sent(),this.fc.shift(),this.Zi.reset(),[3,4];case 3:if(!Na(e=t.sent()))throw e;return Or("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.fc.length&&this.Zi.ji(function(){return n.Ic()}),t.label=5;case 5:return[2]}})})},Nl.prototype.Tc=function(t){var r=this,e=this.lc.then(function(){return r.mc=!0,t().catch(function(t){throw r._c=t,r.mc=!1,Lr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.mc=!1,t})});return this.lc=e},Nl.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ec(),-1<this.yc.indexOf(t)&&(e=0);n=Rc.createAndSchedule(this,t,e,n,function(t){return r.Ac(t)});return this.wc.push(n),n},Nl.prototype.Ec=function(){this._c&&xr()},Nl.prototype.verifyOperationInProgress=function(){},Nl.prototype.Rc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.lc];case 1:t.sent(),t.label=2;case 2:if(e!==this.lc)return[3,0];t.label=3;case 3:return[2]}})})},Nl.prototype.bc=function(t){for(var e=0,n=this.wc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Nl.prototype.vc=function(r){var i=this;return this.Rc().then(function(){i.wc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.wc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Rc()})},Nl.prototype.Pc=function(t){this.yc.push(t)},Nl.prototype.Ac=function(t){t=this.wc.indexOf(t);this.wc.splice(t,1)},Nl);function Nl(){var e=this;this.lc=Promise.resolve(),this.fc=[],this.dc=!1,this.wc=[],this._c=null,this.mc=!1,this.yc=[],this.Zi=new tc(this,"async_queue_retry"),this.gc=function(){var t=zu();t&&Or("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=zu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.gc)}function Dl(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Rl,Cl=(Ll.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Ll.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Ll.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Ll.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Ll.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Ll.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Ll),kl=(n(Ol,Rl=pl),Ol.prototype._terminate=function(){return this._firestoreClient||Ml(this),this._firestoreClient.terminate()},Ol);function Ol(t,e){var n=this;return(n=Rl.call(this,t,e)||this)._queue=new Al,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Ll(){this._progressObserver={},this._taskCompletionResolver=new Ta,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Pl(t){return t._firestoreClient||Ml(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ml(t){var e,n,r,i=t._freezeSettings(),i=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,new Hh(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling));t._firestoreClient=new Rh(t._credentials,t._queue,i)}var xl=(Wl.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Wl),Fl=(Ql.fromBase64String=function(t){try{return new Ql(ei.fromBase64String(t))}catch(t){throw new Dr(Nr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},Ql.fromUint8Array=function(t){return new Ql(ei.fromUint8Array(t))},Ql.prototype.toBase64=function(){return this._byteString.toBase64()},Ql.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},Ql.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Ql.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},Ql),Vl=function(t){this._methodName=t},Ul=(Object.defineProperty(Hl.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(Hl.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),Hl.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Hl.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},Hl.prototype._compareTo=function(t){return qr(this._lat,t._lat)||qr(this._long,t._long)},Hl),ql=/^__.*__$/,Bl=(Kl.prototype.toMutation=function(t,e){return null!==this.fieldMask?new as(t,this.data,this.fieldMask,e,this.fieldTransforms):new ss(t,this.data,e,this.fieldTransforms)},Kl),jl=(Gl.prototype.toMutation=function(t,e){return new as(t,this.data,this.fieldMask,e,this.fieldTransforms)},Gl);function Gl(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Kl(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Hl(t,e){if(!isFinite(t)||t<-90||90<t)throw new Dr(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Dr(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function Ql(t){this._byteString=t}function Wl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zr(t)}function zl(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw xr()}}var Yl=(Object.defineProperty($l.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty($l.prototype,"Sc",{get:function(){return this.settings.Sc},enumerable:!1,configurable:!0}),$l.prototype.Dc=function(t){return new $l(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},$l.prototype.Cc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Dc({path:e,Nc:!1});return e.xc(t),e},$l.prototype.Fc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Dc({path:t,Nc:!1});return t.Vc(),t},$l.prototype.kc=function(t){return this.Dc({path:void 0,Nc:!0})},$l.prototype.Oc=function(t){return Df(t,this.settings.methodName,this.settings.$c||!1,this.path,this.settings.Mc)},$l.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},$l.prototype.Vc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.xc(this.path.get(t))},$l.prototype.xc=function(t){if(0===t.length)throw this.Oc("Document fields must not be empty");if(zl(this.Sc)&&ql.test(t))throw this.Oc('Document fields cannot begin and end with "__"')},$l),Xl=(Jl.prototype.Lc=function(t,e,n,r){return void 0===r&&(r=!1),new Yl({Sc:t,methodName:e,Mc:n,path:Zr.emptyPath(),Nc:!1,$c:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},Jl);function Jl(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Yu(t)}function $l(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Vc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function Zl(t){var e=t._freezeSettings(),n=Yu(t._databaseId);return new Xl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function tf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Lc(o.merge||o.mergeFields?2:0,e,n,i);If("Data must be an object, but it was:",s,r);var a,u,r=Ef(r,s);if(o.merge)a=new ti(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Sf(e,l[h],n);if(!s.contains(f))throw new Dr(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Rf(c,f)||c.push(f)}a=new ti(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Bl(new Ri(r),a,u)}var ef,nf=(n(rf,ef=Vl),rf.prototype._toFieldTransform=function(t){if(2!==t.Sc)throw 1===t.Sc?t.Oc(this._methodName+"() can only appear at the top level of your update data"):t.Oc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},rf.prototype.isEqual=function(t){return t instanceof rf},rf);function rf(){return null!==ef&&ef.apply(this,arguments)||this}function of(t,e,n){return new Yl({Sc:3,Mc:e.settings.Mc,methodName:t._methodName,Nc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var sf,af,uf,cf,hf=(n(vf,cf=Vl),vf.prototype._toFieldTransform=function(t){return new Xo(t.path,new xo)},vf.prototype.isEqual=function(t){return t instanceof vf},vf),lf=(n(gf,uf=Vl),gf.prototype._toFieldTransform=function(t){var e=of(this,t,!0),n=this.Bc.map(function(t){return _f(t,e)}),n=new Fo(n);return new Xo(t.path,n)},gf.prototype.isEqual=function(t){return this===t},gf),ff=(n(yf,af=Vl),yf.prototype._toFieldTransform=function(t){var e=of(this,t,!0),n=this.Bc.map(function(t){return _f(t,e)}),n=new jo(n);return new Xo(t.path,n)},yf.prototype.isEqual=function(t){return this===t},yf),pf=(n(df,sf=Vl),df.prototype._toFieldTransform=function(t){var e=new Qo(t.R,Oo(t.R,this.qc));return new Xo(t.path,e)},df.prototype.isEqual=function(t){return this===t},df);function df(t,e){var n=this;return(n=sf.call(this,t)||this).qc=e,n}function yf(t,e){var n=this;return(n=af.call(this,t)||this).Bc=e,n}function gf(t,e){var n=this;return(n=uf.call(this,t)||this).Bc=e,n}function vf(){return null!==cf&&cf.apply(this,arguments)||this}function mf(t,r,i,e){var o=t.Lc(1,r,i);If("Data must be an object, but it was:",o,e);var s=[],a=Ri.empty();Wr(e,function(t,e){var n=Nf(r,t,i);e=v(e);t=o.Fc(n);e instanceof nf?s.push(n):null!=(t=_f(e,t))&&(s.push(n),a.set(n,t))});e=new ti(s);return new jl(a,e,o.fieldTransforms)}function wf(t,e,n,r,i,o){var s=t.Lc(1,e,n),a=[Sf(e,r,n)],u=[i];if(o.length%2!=0)throw new Dr(Nr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Sf(e,o[c])),u.push(o[c+1]);for(var h,l,f,p=[],d=Ri.empty(),y=a.length-1;0<=y;--y)Rf(p,a[y])||(h=a[y],l=v(l=u[y]),f=s.Fc(h),l instanceof nf?p.push(h):null!=(f=_f(l,f))&&(p.push(h),d.set(h,f)));i=new ti(p);return new jl(d,i,s.fieldTransforms)}function bf(t,e,n,r){return void 0===r&&(r=!1),_f(n,t.Lc(r?4:3,e))}function _f(s,t){if(Tf(s=v(s)))return If("Unsupported field value:",t,s),Ef(s,t);if(s instanceof Vl)return function(t,e){if(!zl(e.Sc))throw e.Oc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Oc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Nc&&4!==t.Sc)throw t.Oc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=_f(i[r],t.kc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=v(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Oo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=jr.fromDate(t);return{timestampValue:na(e.R,n)}}if(t instanceof jr)return n=new jr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:na(e.R,n)};if(t instanceof Ul)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Fl)return{bytesValue:ra(e.R,t._byteString)};if(t instanceof dl){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Oc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:oa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Oc("Unsupported field value: "+ul(t))}(s,t)}function Ef(t,n){var r={};return zr(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Wr(t,function(t,e){e=_f(e,n.Cc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Tf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof jr||t instanceof Ul||t instanceof Fl||t instanceof dl||t instanceof Vl)}function If(t,e,n){if(!Tf(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=ul(n);throw"an object"===n?e.Oc(t+" a custom object"):e.Oc(t+" "+n)}var r}function Sf(t,e,n){if((e=v(e))instanceof xl)return e._internalPath;if("string"==typeof e)return Nf(t,e);throw Df("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Af=new RegExp("[~\\*/\\[\\]]");function Nf(e,n,r){if(0<=n.search(Af))throw Df("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(xl.bind.apply(xl,s([void 0],n.split(".")))))._internalPath}catch(t){throw Df("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Df(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Dr(Nr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Rf(t,e){return t.some(function(t){return t.isEqual(e)})}var Cf,kf=(Object.defineProperty(Pf.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Pf.prototype,"ref",{get:function(){return new dl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Pf.prototype.exists=function(){return null!==this._document},Pf.prototype.data=function(){if(this._document){if(this._converter){var t=new Of(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},Pf.prototype.get=function(t){if(this._document){t=this._document.data.field(Mf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Pf),Of=(n(Lf,Cf=kf),Lf.prototype.data=function(){return Cf.prototype.data.call(this)},Lf);function Lf(){return null!==Cf&&Cf.apply(this,arguments)||this}function Pf(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Mf(t,e){return"string"==typeof e?Nf(t,e):(e instanceof xl?e:e._delegate)._internalPath}var xf,Ff,Vf=(Hf.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Hf),Uf=(n(Kf,Ff=kf),Kf.prototype.exists=function(){return Ff.prototype.exists.call(this)},Kf.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new qf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},Kf.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data.field(Mf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},Kf),qf=(n(Gf,xf=Uf),Gf.prototype.data=function(t){return void 0===t&&(t={}),xf.prototype.data.call(this,t)},Gf),Bf=(Object.defineProperty(jf.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(jf.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(jf.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),jf.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new qf(r._firestore,r._userDataWriter,t.key,t,new Vf(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query._converter))})},jf.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Dr(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new qf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Vf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new qf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Vf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},jf);function jf(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Vf(r.hasPendingWrites,r.fromCache),this.query=n}function Gf(){return null!==xf&&xf.apply(this,arguments)||this}function Kf(t,e,n,r,i,o){var s=this;return(s=Ff.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function Hf(t,e){this.hasPendingWrites=t,this.fromCache=e}function Qf(t,e){return t instanceof Uf&&e instanceof Uf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Bf&&e instanceof Bf&&t._firestore===e._firestore&&Sl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Wf(t){if(mo(t)&&0===t.explicitOrderBy.length)throw new Dr(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}Te=function(){};function zf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Yf,Xf,Jf,$f,Zf,tp=(n(cp,Zf=Te),cp.prototype._apply=function(t){var e=Zl(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){fp(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(lp(n,t,c))}h={arrayValue:{values:s}}}else h=lp(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||fp(o,i),h=bf(e,"where",o,"in"===i||"not-in"===i);var h=Ui.create(r,i,h);return function(t,e){if(e.g()){var n=bo(t);if(null!==n&&!n.isEqual(e.field))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=wo(t);null!==n&&pp(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.Uc,this.Qc,this.Kc);return new yl(t.firestore,t._converter,(t=t._query,e=t.filters.concat([e]),new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},cp),ep=(n(up,$f=Te),up.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new lo(e,n);return e=r,null!==wo(n=t)||null!==(t=bo(n))&&pp(0,t,e.field),r}(t._query,this.Uc,this.jc);return new yl(t.firestore,t._converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new yo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},up),np=(n(ap,Jf=Te),ap.prototype._apply=function(t){return new yl(t.firestore,t._converter,Io(t._query,this.Wc,this.Gc))},ap),rp=(n(sp,Xf=Te),sp.prototype._apply=function(t){var e=hp(t,this.type,this.zc,this.Hc);return new yl(t.firestore,t._converter,(t=t._query,e=e,new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},sp),ip=(n(op,Yf=Te),op.prototype._apply=function(t){var e=hp(t,this.type,this.zc,this.Hc);return new yl(t.firestore,t._converter,(t=t._query,e=e,new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},op);function op(t,e,n){var r=this;return(r=Yf.call(this)||this).type=t,r.zc=e,r.Hc=n,r}function sp(t,e,n){var r=this;return(r=Xf.call(this)||this).type=t,r.zc=e,r.Hc=n,r}function ap(t,e,n){var r=this;return(r=Jf.call(this)||this).type=t,r.Wc=e,r.Gc=n,r}function up(t,e){var n=this;return(n=$f.call(this)||this).Uc=t,n.jc=e,n.type="orderBy",n}function cp(t,e,n){var r=this;return(r=Zf.call(this)||this).Uc=t,r.Qc=e,r.Kc=n,r.type="where",r}function hp(t,c,e,n){if(e[0]=v(e[0]),e[0]instanceof kf)return function(t,e,n,r){if(!n)throw new Dr(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Eo(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(Ti(e,n.key));else{var u=n.data.field(a.field);if(li(u))throw new Dr(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new oo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=Zl(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Dr(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!_o(t)&&-1!==c.indexOf("/"))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Jr.fromString(c));if(!yi.isDocumentKey(h))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new yi(h);a.push(Ti(e,h))}else{c=bf(n,r,c);a.push(c)}}return new oo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function lp(t,e,n){if("string"==typeof(n=v(n))){if(""===n)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!_o(e)&&-1!==n.indexOf("/"))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(Jr.fromString(n));if(!yi.isDocumentKey(e))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Ti(t,new yi(e))}if(n instanceof dl)return Ti(t,n._key);throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ul(n)+".")}function fp(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function pp(t,e,n){if(!n.isEqual(e))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}dp.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),vi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ci(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(hi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw xr()}},dp.prototype.convertObject=function(t,n){var r=this,i={};return Wr(t.fields||{},function(t,e){i[t]=r.convertValue(e,n)}),i},dp.prototype.convertGeoPoint=function(t){return new Ul(ci(t.latitude),ci(t.longitude))},dp.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},dp.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return li(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(fi(t));default:return null}},dp.prototype.convertTimestamp=function(t){t=ui(t);return new jr(t.seconds,t.nanos)},dp.prototype.convertDocumentKey=function(t,e){var n=Jr.fromString(t);Fr(Ea(n));t=new Qh(n.get(1),n.get(3)),n=new yi(n.popFirst(5));return t.isEqual(e)||Lr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},_=dp;function dp(){}function yp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var gp,vp=(n(bp,gp=_),bp.prototype.convertBytes=function(t){return new Fl(t)},bp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new dl(this.firestore,null,t)},bp),mp=(wp.prototype.set=function(t,e,n){this._verifyNotCommitted();t=_p(t,this._firestore),e=yp(t._converter,e,n),n=tf(this._dataReader,"WriteBatch.set",t._key,e,null!==t._converter,n);return this._mutations.push(n.toMutation(t._key,$o.none())),this},wp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=_p(t,this._firestore),e="string"==typeof(e=v(e))||e instanceof xl?wf(this._dataReader,"WriteBatch.update",t._key,e,n,r):mf(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,$o.exists(!0))),this},wp.prototype.delete=function(t){this._verifyNotCommitted();t=_p(t,this._firestore);return this._mutations=this._mutations.concat(new vs(t._key,$o.none())),this},wp.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},wp.prototype._verifyNotCommitted=function(){if(this._committed)throw new Dr(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},wp);function wp(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Zl(t)}function bp(t){var e=this;return(e=gp.call(this)||this).firestore=t,e}function _p(t,e){if((t=v(t)).firestore!==e)throw new Dr(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ep,Tp=(n(Ip,Ep=_),Ip.prototype.convertBytes=function(t){return new Fl(t)},Ip.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new dl(this.firestore,null,t)},Ip);function Ip(t){var e=this;return(e=Ep.call(this)||this).firestore=t,e}function Sp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=cl(t,dl);var o=cl(t.firestore,kl),s=Zl(o);return Np(o,[("string"==typeof(e=v(e))||e instanceof xl?wf(s,"updateDoc",t._key,e,n,r):mf(s,"updateDoc",t._key,e)).toMutation(t._key,$o.exists(!0))])}function Ap(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e=v(e);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Dl(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return Dl(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof dl?(a=cl(e.firestore,kl),u=go(e._key.path),h={next:function(t){n[i]&&n[i](Dp(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=cl(e,yl),a=cl(s.firestore,kl),u=s._query,c=new Tp(a),h={next:function(t){n[i]&&n[i](new Bf(a,c,s,t))},error:n[i+1],complete:n[i+2]},Wf(e._query)),function(n,t,e){var r=this,i=new Sh(h),o=new Gc(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=qc,[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Bc,[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Pl(a),u,l)}function Np(t,e){return function(n,r){var t=this,i=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=ah,[4,qh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Pl(t),e)}function Dp(t,e,n){var r=n.docs.get(e._key),i=new Tp(t);return new Uf(t,i,e._key,r,new Vf(n.hasPendingWrites,n.fromCache),e._converter)}var Rp,Cp=(Op.prototype.get=function(t){var e=this,n=_p(t,this._firestore),r=new vp(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return xr();t=t[0];if(t.isFoundDocument())return new kf(e._firestore,r,t.key,t,n._converter);if(t.isNoDocument())return new kf(e._firestore,r,n._key,null,n._converter);throw xr()})},Op.prototype.set=function(t,e,n){t=_p(t,this._firestore),e=yp(t._converter,e,n),n=tf(this._dataReader,"Transaction.set",t._key,e,null!==t._converter,n);return this._transaction.set(t._key,n),this},Op.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=_p(t,this._firestore),e="string"==typeof(e=v(e))||e instanceof xl?wf(this._dataReader,"Transaction.update",t._key,e,n,r):mf(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Op.prototype.delete=function(t){t=_p(t,this._firestore);return this._transaction.delete(t._key),this},n(kp,Rp=Op),kp.prototype.get=function(t){var e=this,n=_p(t,this._firestore),r=new Tp(this._firestore);return Rp.prototype.get.call(this,t).then(function(t){return new Uf(e._firestore,r,n._key,t._document,new Vf(!1,!1),n._converter)})},kp);function kp(t,e){var n=this;return(n=Rp.call(this,t,e)||this)._firestore=t,n}function Op(t,e){this._firestore=t,this._transaction=e,this._dataReader=Zl(t)}function Lp(){if("undefined"==typeof Uint8Array)throw new Dr(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Pp(){if("undefined"==typeof atob)throw new Dr(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Mp,xp=(Kp.fromBase64String=function(t){return Pp(),new Kp(Fl.fromBase64String(t))},Kp.fromUint8Array=function(t){return Lp(),new Kp(Fl.fromUint8Array(t))},Kp.prototype.toBase64=function(){return Pp(),this._delegate.toBase64()},Kp.prototype.toUint8Array=function(){return Lp(),this._delegate.toUint8Array()},Kp.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Kp.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Kp),Fp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Vp=(Gp.prototype.enableIndexedDbPersistence=function(t,e){throw new Dr(Nr.FAILED_PRECONDITION,Fp)},Gp.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new Dr(Nr.FAILED_PRECONDITION,Fp)},Gp.prototype.clearIndexedDbPersistence=function(t){throw new Dr(Nr.FAILED_PRECONDITION,Fp)},Gp),Up=(Object.defineProperty(jp.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),jp.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},jp.prototype.useEmulator=function(t,e){var n,r;n=this._delegate,r=t,t=e,"firestore.googleapis.com"!==(e=(n=cl(n,pl))._getSettings()).host&&e.host!==r&&Pr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},jp.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,Fh(i)];case 1:return n=t.sent(),[4,Uh(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).$r.delete(0),lc(e))]}var e})})})}(Pl(cl(this._delegate,kl)))},jp.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Fh(r)];case 1:return e=t.sent(),[4,Uh(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).$r.add(0),[4,fc(e)];case 1:return t.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Pl(cl(this._delegate,kl)))},jp.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ol("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Jc.enableMultiTabIndexedDbPersistence(this):this.Jc.enableIndexedDbPersistence(this,n)},jp.prototype.clearPersistence=function(){return this.Jc.clearIndexedDbPersistence(this)},jp.prototype.terminate=function(){return this.Yc&&(this.Yc._removeServiceInstance("firestore"),this.Yc._removeServiceInstance("firestore-exp")),this._delegate._delete()},jp.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=hh,[4,qh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Pl(cl(this._delegate,kl)))},jp.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new Sh(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,Bh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Pl(cl(e,kl)),Dl(t)?t:{next:t});var e},Object.defineProperty(jp.prototype,"app",{get:function(){if(!this.Yc)throw new Dr(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yc},enumerable:!1,configurable:!0}),jp.prototype.collection=function(t){try{return new cd(this,El(this._delegate,t))}catch(t){throw Zp(t,"collection()","Firestore.collection()")}},jp.prototype.doc=function(t){try{return new Jp(this,Tl(this._delegate,t))}catch(t){throw Zp(t,"doc()","Firestore.doc()")}},jp.prototype.collectionGroup=function(t){try{return new sd(this,function(t,e){if(t=cl(t,pl),rl("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Dr(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new yl(t,null,(e=e,new yo(Jr.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Zp(t,"collectionGroup()","Firestore.collectionGroup()")}},jp.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,xh(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new Dh(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Pl(n=this._delegate),function(t){return t=new Cp(n,t),e(new Hp(r,t))})},jp.prototype.batch=function(){var e=this;return Pl(this._delegate),new Qp(new mp(this._delegate,function(t){return Np(e._delegate,t)}))},jp.prototype.loadBundle=function(t){throw new Dr(Nr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},jp.prototype.namedQuery=function(t){throw new Dr(Nr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},jp),qp=(n(Bp,Mp=_),Bp.prototype.convertBytes=function(t){return new xp(new Fl(t))},Bp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return Jp.Xc(t,this.firestore,null)},Bp);function Bp(t){var e=this;return(e=Mp.call(this)||this).firestore=t,e}function jp(t,e,n){var r=this;this._delegate=e,this.Jc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Qh||(this.Yc=t)}function Gp(){}function Kp(t){this._delegate=t}var Hp=(Xp.prototype.get=function(t){var e=this,n=gd(t);return this._delegate.get(n).then(function(t){return new id(e._firestore,new Uf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},Xp.prototype.set=function(t,e,n){t=gd(t);return n?(il("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Xp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=gd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Xp.prototype.delete=function(t){t=gd(t);return this._delegate.delete(t),this},Xp),Qp=(Yp.prototype.set=function(t,e,n){t=gd(t);return n?(il("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Yp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=gd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Yp.prototype.delete=function(t){t=gd(t);return this._delegate.delete(t),this},Yp.prototype.commit=function(){return this._delegate.commit()},Yp),Wp=(zp.prototype.fromFirestore=function(t,e){t=new qf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new od(this._firestore,t),null!=e?e:{})},zp.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},zp.Zc=function(t,e){var n=zp.tu,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new zp(t,new qp(t),e),r.set(e,n)),n},zp);function zp(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function Yp(t){this._delegate=t}function Xp(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}Wp.tu=new WeakMap;var Jp=($p.eu=function(t,e,n){if(t.length%2!=0)throw new Dr(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new $p(e,new dl(e._delegate,n,new yi(t)))},$p.Xc=function(t,e,n){return new $p(e,new dl(e._delegate,n,t))},Object.defineProperty($p.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty($p.prototype,"parent",{get:function(){return new cd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty($p.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),$p.prototype.collection=function(t){try{return new cd(this.firestore,El(this._delegate,t))}catch(t){throw Zp(t,"collection()","DocumentReference.collection()")}},$p.prototype.isEqual=function(t){return(t=v(t))instanceof dl&&Il(this._delegate,t)},$p.prototype.set=function(t,e){e=il("DocumentReference.set",e);try{return function(t,e,n){t=cl(t,dl);var r=cl(t.firestore,kl),e=yp(t._converter,e,n);return Np(r,[tf(Zl(r),"setDoc",t._key,e,null!==t._converter,n).toMutation(t._key,$o.none())])}(this._delegate,t,e)}catch(t){throw Zp(t,"setDoc()","DocumentReference.set()")}},$p.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Sp(this._delegate,t):Sp.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw Zp(t,"updateDoc()","DocumentReference.update()")}},$p.prototype.delete=function(){return Np(cl((t=this._delegate).firestore,kl),[new vs(t._key,$o.none())]);var t},$p.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=td(t),i=ed(t,function(t){return new id(e.firestore,new Uf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))});return Ap(this._delegate,r,i)},$p.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=cl(e,dl);var n=cl(e.firestore,kl),t=Pl(n),r=new Tp(n);return function(n,r){var t=this,i=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)}))];case 1:return(i=t.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new Dr(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=kc(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Vh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new Uf(n,r,e._key,t,new Vf(null!==t&&t.hasLocalMutations,!0),e._converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=cl(e,dl);var n=cl(e.firestore,kl);return jh(Pl(n),e._key,{source:"server"}).then(function(t){return Dp(n,e,t)})}:function(e){e=cl(e,dl);var n=cl(e.firestore,kl);return jh(Pl(n),e._key).then(function(t){return Dp(n,e,t)})})(this._delegate).then(function(t){return new id(e.firestore,new Uf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},$p.prototype.withConverter=function(t){return new $p(this.firestore,t?this._delegate.withConverter(Wp.Zc(this.firestore,t)):this._delegate.withConverter(null))},$p);function $p(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}function Zp(t,e,n){return t.message=t.message.replace(e,n),t}function td(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Dl(r))return r}return{}}function ed(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=Dl(t[0])?t[0]:Dl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var nd,rd,id=(Object.defineProperty(yd.prototype,"ref",{get:function(){return new Jp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),yd.prototype.data=function(t){return this._delegate.data(t)},yd.prototype.get=function(t,e){return this._delegate.get(t,e)},yd.prototype.isEqual=function(t){return Qf(this._delegate,t._delegate)},yd),od=(n(dd,rd=id),dd.prototype.data=function(t){return this._delegate.data(t)},dd),sd=(pd.prototype.where=function(t,e,n){try{return new pd(this.firestore,zf(this._delegate,(r=n,i=e,o=Mf("where",t),new tp(o,i,r))))}catch(t){throw Zp(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},pd.prototype.orderBy=function(t,e){try{return new pd(this.firestore,zf(this._delegate,(n=void 0===e?"asc":e,r=Mf("orderBy",t),new ep(r,n))))}catch(t){throw Zp(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},pd.prototype.limit=function(t){try{return new pd(this.firestore,zf(this._delegate,(hl("limit",e=t),new np("limit",e,"F"))))}catch(t){throw Zp(t,"limit()","Query.limit()")}var e},pd.prototype.limitToLast=function(t){try{return new pd(this.firestore,zf(this._delegate,(hl("limitToLast",e=t),new np("limitToLast",e,"L"))))}catch(t){throw Zp(t,"limitToLast()","Query.limitToLast()")}var e},pd.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new pd(this.firestore,zf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rp("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Zp(t,"startAt()","Query.startAt()")}},pd.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new pd(this.firestore,zf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rp("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Zp(t,"startAfter()","Query.startAfter()")}},pd.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new pd(this.firestore,zf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ip("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Zp(t,"endBefore()","Query.endBefore()")}},pd.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new pd(this.firestore,zf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ip("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Zp(t,"endAt()","Query.endAt()")}},pd.prototype.isEqual=function(t){return Sl(this._delegate,t._delegate)},pd.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=cl(e,yl);var n=cl(e.firestore,kl),t=Pl(n),r=new Tp(n);return function(n,r){var t=this,i=new Ta;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,uu(i,o,!0)];case 1:return r=t.sent(),e=new th(o,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=kc(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Vh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new Bf(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=cl(e,yl);var n=cl(e.firestore,kl),t=Pl(n),r=new Tp(n);return Gh(t,e._query,{source:"server"}).then(function(t){return new Bf(n,r,e,t)})}:function(e){e=cl(e,yl);var n=cl(e.firestore,kl),t=Pl(n),r=new Tp(n);return Wf(e._query),Gh(t,e._query).then(function(t){return new Bf(n,r,e,t)})})(this._delegate).then(function(t){return new ud(e.firestore,new Bf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},pd.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=td(t),i=ed(t,function(t){return new ud(e.firestore,new Bf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return Ap(this._delegate,r,i)},pd.prototype.withConverter=function(t){return new pd(this.firestore,t?this._delegate.withConverter(Wp.Zc(this.firestore,t)):this._delegate.withConverter(null))},pd),ad=(Object.defineProperty(fd.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(fd.prototype,"doc",{get:function(){return new od(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(fd.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(fd.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),fd),ud=(Object.defineProperty(ld.prototype,"query",{get:function(){return new sd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new od(e._firestore,t)})},enumerable:!1,configurable:!0}),ld.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new ad(e._firestore,t)})},ld.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new od(r._firestore,t))})},ld.prototype.isEqual=function(t){return Qf(this._delegate,t._delegate)},ld),cd=(n(hd,nd=sd),Object.defineProperty(hd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Jp(this.firestore,t):null},enumerable:!1,configurable:!0}),hd.prototype.doc=function(t){try{return new Jp(this.firestore,void 0===t?Tl(this._delegate):Tl(this._delegate,t))}catch(t){throw Zp(t,"doc()","CollectionReference.doc()")}},hd.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=cl(e.firestore,kl),r=Tl(e),n=yp(e._converter,n),Np(t,[tf(Zl(e.firestore),"addDoc",r._key,n,null!==e._converter,{}).toMutation(r._key,$o.exists(!1))]).then(function(){return r}).then(function(t){return new Jp(i.firestore,t)})},hd.prototype.isEqual=function(t){return Il(this._delegate,t._delegate)},hd.prototype.withConverter=function(t){return new hd(this.firestore,t?this._delegate.withConverter(Wp.Zc(this.firestore,t)):this._delegate.withConverter(null))},hd);function hd(t,e){var n=this;return(n=nd.call(this,t,e)||this).firestore=t,n._delegate=e,n}function ld(t,e){this._firestore=t,this._delegate=e}function fd(t,e){this._firestore=t,this._delegate=e}function pd(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new qp(t)}function dd(){return null!==rd&&rd.apply(this,arguments)||this}function yd(t,e){this._firestore=t,this._delegate=e}function gd(t){return cl(t,dl)}md.documentId=function(){return new md(Zr.keyField().canonicalString())},md.prototype.isEqual=function(t){return(t=v(t))instanceof xl&&this._delegate._internalPath.isEqual(t._internalPath)},Te=md,vd.serverTimestamp=function(){var t=new hf("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new vd(t)},vd.delete=function(){var t=new nf("deleteField");return t._methodName="FieldValue.delete",new vd(t)},vd.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new lf("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new vd(n)},vd.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ff("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new vd(n)},vd.increment=function(t){t=new pf("increment",t);return t._methodName="FieldValue.increment",new vd(t)},vd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},_=vd;function vd(t){this._delegate=t}function md(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(xl.bind.apply(xl,s([void 0],t)))}function wd(t){return e=this._delegate,s=t,n=Pl(e=cl(e,kl)),t=new Cl,function(n,t,r){var e,i=this,o=(e=s,t=Yu(t),e=function(t){if(t instanceof Uint8Array)return Ih(t,void 0);if(t instanceof ArrayBuffer)return Ih(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Ah(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=wh,[4,qh(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function bd(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Qe.getNamedQuery(t,e)})},[4,Vh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Pl(n=cl(n,kl)),t).then(function(t){return t?new yl(n,null,t.query):null}).then(function(t){return t?new sd(e,t):null})}var _d=(Ed.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ed.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ed.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ed);function Ed(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Td,Id,Sd={Firestore:Up,GeoPoint:Ul,Timestamp:jr,Blob:xp,Transaction:Hp,WriteBatch:Qp,DocumentReference:Jp,DocumentSnapshot:id,Query:sd,QueryDocumentSnapshot:od,QuerySnapshot:ud,CollectionReference:cd,FieldPath:Te,FieldValue:_,setLogLevel:function(t){Rr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Td=e.default).INTERNAL.registerComponent(new _d("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Up(e,new kl(e,t),new Vp)},"PUBLIC").setServiceProps(Object.assign({},Sd))),Td.registerVersion("@firebase/firestore","2.2.2"),(Id=Up).prototype.loadBundle=wd,Id.prototype.namedQuery=bd}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
